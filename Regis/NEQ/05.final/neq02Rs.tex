%%%\documentclass[a4wide,10pt]{article}
\documentstyle[a4wide,10pt]{article}
%% \makeatletter

%%%\setlength{\textwidth}{17cm}
%%%\setlength{\evensidemargin}{-.8cm}
%%%\setlength{\oddsidemargin}{-.8cm}

%% \makeatother
\input{defs}

\begin{document}

\title{Cut-Elimination and Other Gimmicks\\ for Logic of Nondeterminism}

\author{ {\em Regimantas ~Pliu\v skevi\v cius}\ \thanks{Department of Mathematical Logic,
Vilnius Institute of Mathematics and Informatics, Lithuania,
{\sl \{logica@sedcs.mii2.lt\}}} \\
{\em Micha{\l}~Walicki}\ \thanks{Department of Informatics, University of Bergen, 5020
Bergen, Norway, {\sl \{michal@ii.uib.no\}}} \\
{\em Jurate~Sakalauskait\.e }$^*$ \\
{\em Aida~Pliu\v skevi\v cien\.e }$^*$ 
% \ \footnote{All authors gratefully acknowledge the financial support
% received from the Norwegian Research Council.}
}
%
%\author{ {\em R. \& A.~Pliu\v skevi\v ciai \thanks{All authors gratefully 
%acknowledge the financial support received from the Norwegian Research Council.}}\\
%{\em J.~Sakalauskait\.e,  V.~Kria\v ciukas }\\
%\small Department of Mathematical Logic\\
%\small Institute of Mathematics and Informatics\\
%\small Vilnius, Lithuania\\
%\footnotesize logica@sedcs.mii2.lt 
%\and 
%{\it } {\em M.~Walicki\(\ ^*\)}\\
%{\em S.~Meldal }\\ 
%\small Department of Informatics\\
%\small University of Bergen\\
%\small Bergen, Norway\\
%{\footnotesize \{michal,sigurd\}@ii.uib.no}}

%\date{}
\maketitle


%\abstract {}

\section{Introduction}
The paper starts (section~\ref{se:specs}) with a sound and complete calculus $NEQ$ for the
multialgebraic semantics of nondeterminism (whose different variants were studied in 
\cite{Mich}, \cite{WM}, \cite{Top}). Using techniques of \cite{K}, \cite{Aida1}, \cite{Aida2},
and their refinements and modifications, the paper presents a series
of transformations (sections~\ref{se:neq1}-\ref{se:lastNEQ}) leading
to an equivalent calculus without the general ($cut$) rule. The
specific (non-logical) axioms are replaced by the {\em specific-cut}
rules, and several other useful specializations of rules are
introduced. Section~\ref{se:noax} studies also the situation when no specific
axioms are present, showing that in this case no cut or elimination rules are needed.
Sections~\ref{se:connectives} and \ref{se:related} contain some concluding remarks.

The impatient reader, interested only in the main results, may consult directly:\\[1ex]
\begin{tabular}{rlcl}
1. &  figure \ref{fi:neq} on page \pageref{fi:neq} & -- & the original version of
the calculus $NEQ$ \\
2. & figure \ref{fi:neq5} on page \pageref{fi:neq5} & -- & the final cut-free
version $NEQ_5$ \\
% & & & specific axioms are dealt with by means of  \\
 & & & with the specific-cut rules \\
3. & lemma \ref{le:elcut}, page \pageref{le:elcut}, and & -- & the two main elimination results \\
 & lemma \ref{le:nocutx}, page \pageref{le:nocutx} \\
4. & figure \ref{fi:neq6} on page \pageref{fi:neq6} & -- & the final calculus
without specific axioms $NEQ_6$ \\ 
 & & & not containing cut, specific cut or elimination rules \\
5. & section \ref{se:connectives} & -- & final comments
\end{tabular}

\section{Specifications of nondeterministic operations}\label{se:specs}

\begin{DEFINITION} {\bf (Specifications)} \label{de:terms-vars-forms}
A specification SP is a pair ($\Sigma,\Ax$). The signature $\Sigma$ is a pair
($\Sorts,\Funcs$) of sort and operation symbols. 
%There is a countable set of variables \C V.
The set of terms\footnote{We will not mention sorting explicitly
and always assume that terms and formulae are correctly sorted.}
 built from the variables and
operation symbols is denoted $\Terms{\Funcs,\C V}$. An {\em atomic formula} 
is an {\em equality}, $s=t$, or an {\em inclusion}, $s\Incl t$, of terms
$s,t\in\Terms{\Funcs,\Vars}$ (where $t$ is called the 
right-hand-side (RHS) and $s$ the left-hand-side (LHS) of inclusion).

 $\Ax$ is a set of sequents, $\Gamma\Seq\Delta$, where $\Gamma, \Delta$ are
finite sets of atomic formulae.
\end{DEFINITION}
\noindent
We will write $\C V(\sigma)$ to denote the variables occurring in $\sigma$ 
(which may be any syntactic entity or a set thereof).
%
\begin{DEFINITION} {\bf (Multialgebras)} \label{de:multialgebras}
For a given signature $\Sigma=(\Sorts,\Funcs)$, a {\em $\Sigma$-multialgebra} $A$
is defined as follows:
\begin{itemize}\MyLPar
\item  the carrier $|A|$ of $A$ consists of a set $S^A$ for each $S\in\Sorts$
\item for each operation $f: \List Sn\times \rightarrow S$, there is an operation
$f^A: \List {S^A}n\times \rightarrow \C P^+(S^A)$, where $\C P^+(X)$ denotes the 
power set of the set $X$ with empty set excluded.
\end{itemize}
\end{DEFINITION}
\noindent
Given a multialgebra $A$ and an assignment $\beta:X\rightarrow |A|$, there is a
unique interpretation function $\beta [\_]$ in $A$ of each term $t$ 
with $\C V(t)\subseteq X$ defined as:
\[ \begin{array}{ccccc} 
\beta [x] = \beta (x) & & \beta [c] = c^A
& & \beta [f(\List tn,)] = f^A(\beta[t_1]\ldots \beta[t_n]) 
\end{array} \]
%
\begin{DEFINITION} {\bf (Semantics)} \label{de:semantics}
A $\Sigma$-multialgebra $A$ satisifes an atomic formula $\phi$ under assignment
 $\beta:X\rightarrow |A|$, written $A,\beta\models \phi$, iff:
\begin{itemize}\MyLPar
\item $\phi$ is $s=t$, and $\beta[s]=\beta[t]=\{\alpha\}$ for some $\alpha\in |A|$
\item $\phi$ is $s\Incl t$, and $\beta[s]\subseteq\beta[t]$.
\end{itemize}
 $A$ satisifes a sequent, $A\models\Gamma\Seq\Delta$ iff,
for each assignment $\beta$, there exists a $\gamma\in\Gamma : A,\beta\not\models
\gamma$, or there exists a $\delta\in\Delta: A,\beta\models \delta$. 
%satisfies at least one of the atoms in $\Delta$ or $A$ does not satisfy at least
%one of the atoms in $\Gamma$.
A $\Sigma$-multialgebra $A$ is an SP{\em-multimodel}, $A\in \MMod(SP)$, iff it satisfies 
all axioms $\Ax$ of SP.
\end{DEFINITION}
\noindent
The natural deduction-like calculus $NEQ$ consists of the rules given in
figure \ref{fi:neq} \cite{WM}. Each specification contains a set
$\Ax$ of {\em specific axioms} \reff{ru:spax}.
\begin{figure}[hbt]
\hspace*{3em}\begin{tabular}{|ll|}
\hline
\multicolumn{2}{|c|}{{\bf Axioms} :}\\[.5ex]
\TABRUL{\Seq x=x : x\in\Vars} \label{ru:neqx} & 
\TABRUL{s\odot t \Seq s\odot t} \label{ru:neqid}\ \ \ \ $\odot\in\{=,\Incl\}$  \\[2ex]
%%& {\footnotesize \ \ \ \ \ \ \ \ \ - $\odot\in\{=,\Incl\}$} \\[2ex]
%
\multicolumn{2}{|c|}{{\bf Identity and inclusion rules} :}\\[.5ex]
\TABRULE{
\Gamma_t^x\Seq\Delta_t^x \ \ ; \ \ \Gamma'\Seq s=t,\Delta'}
{\Gamma_s^x,\Gamma'\Seq\Delta_s^x,\Delta' } \label{ru:neqeq} & 
\TABRULE{
\Gamma\Seq\Delta, w(t)\preceq q \ \ ; \ \ \Gamma'\Seq s\Incl t,\Delta'}
{\Gamma,\Gamma'\Seq\Delta',\Delta, w(s)\preceq q} \label{ru:neqincl} \\[4ex]
%& {\footnotesize \ \ \ - $x$ not  in a RHS of $\Incl$ in $\Delta$.} \\[2ex]
%
\multicolumn{2}{|c|}{{\bf Elimination rules} ($elim1$) and ($E_a$) :}\\[.5ex]
\TABRULE{\Gamma, x\Incl t\Seq\Delta} 
{\Gamma_t^x\Seq\Delta_t^x} \label{ru:elim1} 
& \TABRULE{x\Incl t, y\Incl r(x), \Gamma\Seq\Delta} 
{y\Incl r(t),\Gamma\Seq\Delta} \label{ru:elim2}  \\
%\noindent
{\footnotesize \ \ \ - $x\not\in \Vars(t)$;} & {\footnotesize \ \ \ -
$x\not\in\Vars(t,y,\Gamma,\Delta), y\in\Vars$}  \\
{\footnotesize \ \ \ - $x$ occurs at most once
in $\Gamma\Seq\Delta$ } & {\footnotesize \ \ \ - $x$ occurs at most once in $r$}  \\
{\footnotesize \ \ \ - and not in a RHS of $\Incl$ in $\Gamma$} &  \\[2ex]
% 
\multicolumn{2}{|c|}{{\bf Weakening rules} ($W$) :}\\[.5ex]
\multicolumn{1}{|r}{\prule{\Gamma\Seq\Delta}{\Gamma\Seq\Delta,\atom}}  & 
\TABRULE{\Gamma\Seq\Delta}{\Gamma, \atom\Seq\Delta}\label{ru:weak}   \\[4ex]
%%
\multicolumn{2}{|c|}{{\bf Cut rule} ($cut$) :}\\[.5ex]
\multicolumn{2}{|c|}{\TABRULE{\Gamma\Seq\Delta,\atom\ \ ;\ \ \atom,\Gamma'\Seq\Delta'}
{\Gamma,\Gamma'\Seq\Delta,\Delta'}\label{ru:neqcut} } \\[2ex] %\hline
\multicolumn{2}{|c|}{{\bf Specific axioms} :}\\[.5ex]
\multicolumn{2}{|c|}{\TABRUL{\lis\atom\Seq \lism\batom{m}}\label{ru:spax}
 ($\Ax_k$)\ \ \ \  where $k$ identifies a particular axiom in the set $\Ax$.}\\[1ex]
\hline
\end{tabular}
\caption{The rules and axioms of $NEQ$}\label{fi:neq}
\end{figure}

\noindent
$\atom$, $\batom$ stand for atoms, i.e., $s\odot t$.
 The symbol $\preceq$ abbreviates either $=$ or $\Incl$. 
$\Gamma_t^x$ indicates replacement of one or more $x$ by $t$.
Sometimes, we may write $\Gamma[x]$, $\phi[x]$ for a (set of) atom(s) containing
$x$, and then $\Gamma[t]$, $\phi[t]$ for the result of replacing these occurrences
of $x$ by $t$.

%
\begin{REMARK} \label{re:1}
{From the definition of a sequent it follows that $NEQ$ implicitly contains the 
structural rules ``exchange'' and ``contraction''.}
$NEQ$ also assumes implicitly symmetry of equations, i.e., $s=t$ is treated as an 
unorded set $\{s,t\}$. 

Two peculiar features of this calculus are the absence of the unrestricted 
substitutivity,
and that $=$ is only a partial equivalence.
  The equality $t=t$ represents ``deterministic equality'' -- it holds only for terms which
denote individual elements of the carrier. Thus, in general, $NEQ\ \not\vdash\ \Seq t=t$. 
Since
variables are assigned only individual elements, we do have $NEQ\vdash\ \Seq x=x$ holds for any
variable $x$. But since
terms may denote {\em sets} of individuals, unrestricted substitutivity would not
be sound wrt. the multialgebraic semantics. For motivations and examples the reader
is referred to \cite{WM,Top,Broy}.
\end{REMARK}
%
\begin{THEOREM}\label{th:cmpl} {\em \cite{WM}}
$NEQ$ is sound and complete with respect to the multialgebraic semantics, i.e.,
for any sequent $S$:
\[\MMod(\Sigma,\Ax)\models S \ \ \iff \ \ \der{\Ax, NEQ}{}S\]
\end{THEOREM}
\noindent
 $\der{\Ax,NEQ}{}S$,  indicating that $S$ is derivable from $\Ax$
using the rules of $NEQ$, might be written in a more standard fashion as
 $\Ax\der{}{NEQ}S$. However, we will consider variants of the calculus
 where the axioms $\Ax$ are built into the rules, and the latter notation will be used
 for a different purpose.

%We  assume given a fixed signature and a set $\Ax$ of
%specific axioms of the general form:
%\PROOFRUL{r_i \odot_i s_i \Seq u_j\odot_j v_j}\label{ru:spax}
% ($\Ax_k$)\ \ \ \  where $k$ identifies a particular axiom in the set $\Ax$.
%
\begin{DEFINITION} Let $I, J$ be arbitrary
calculi. We use the following notational convention:
\begin{itemize}\MyLPar
\item $I \Rightarrow J$ if, for any sequent $S : \der{\Ax, I}{}S 
\ \Rightarrow\  \der{\Ax, J}{}S;$
\item $I\equiv J$ if $I\Rightarrow J$ and $J\Rightarrow I$;
\item $I^c$ denotes $I$ extended with the 
($cut$) rule;
\item $\der IDS$ indicates that $D$ is a derivation of $S$ 
using the rules of calculus $I$;
\item for derivations $D, D'$, we write $D\impl D'$ to indicate that $D'$
may be constructed, assuming that $D$ is given.
\item Variable $x$ in the applications of any of the elimination rules will be called
{\em eigen-variable}.
\end{itemize}
\end{DEFINITION}

\section{Kanger-like calculus -- $NEQ_1$}\label{se:neq1}
In this section we transform $NEQ$ to an equivalent calculus $NEQ_1$ 
with Kanger-like rules for equality \cite{K} and inclusion.

\begin{DEFINITION} \label{de:neq1}
The calculus $NEQ_1$ is obtained from $NEQ$ by the following transformations:\\
\noindent For any $t\in\Terms{\Funcs,\C V}$, the following axiom is added:
\PROOFRUL{\Seq t\Incl t} \label{ru:neq1tint}\\[4pt]
\noindent The axiom \reff{ru:neqid}, $s\odot t\Seq s\odot t$ is replaced by:
\PROOFRUL{s=t\Seq s=t}\label{ru:neq1id}\ \ \ \ where: $s,t\not\in\C V$\\[4pt]
\noindent The inference rules for equality and inclusion~\reff{ru:neqeq}, 
\reff{ru:neqincl} are replaced by:
\PROOFRULE{s=t,\Gamma_t^x\Seq\Delta_t^x}{s=t,\Gamma_s^x\Seq\Delta_s^x} ($=_1$)
\label{ru:K12} \ \ \ \ \ \ \ \ 
\prule{t=s,\Gamma_t^x\Seq\Delta_t^x}{t=s,\Gamma_s^x\Seq\Delta_s^x} ($=_2$)
\PROOFRULE{\Gamma, s\Incl t\Seq \Delta, w(t)\preceq q}{\Gamma, s\Incl t\Seq
\Delta, w(s)\preceq q} ($\Incl_s$)
\label{ru:Kincl}
%\ \ \ \ where: $x$ in $\Delta$ isn't in the RHS of $\Incl$.
\end{DEFINITION}
\noindent
Since the cases for $=_1$ and $=_2$ are entirely symmetric,
% both for  $=_{ia}$ and $=_{is}$, 
in the sequel we'll treat them uniformly and write only $=$.
% $=_s$.

\begin{LEMMA}\label{le:neqtoneq1} $NEQ \Rightarrow NEQ_1$ \end{LEMMA}
\begin{PROOF}
We show that the axioms~\reff{ru:neqid} and inference rules~\reff{ru:neqeq},
\reff{ru:neqincl} are derivable in $NEQ_1$.
%$NEQ_1$ proves all the axioms $S$ and rules $R$ removed from $NEQ$.
\begin{LS}\MyLPar
\item Let $S$ be $s=x\Seq s=x$, where $x\in\C V$ (the case
$x=s\Seq x=s$ is analogous). \\ We derive it in $NEQ_1$: \ \ \ 
%\begin{center} 
\( \begin{array}{cl}
  \Seq x=x & \raisebox{-1.2ex}[1.5ex][0ex]{(W)} \\ \cline{1-1}
  s=x\Seq x=x & \raisebox{-1.2ex}[1.5ex][0ex]{($=$)} \\ \cline{1-1}
  s=x\Seq s=x
\end{array} \) 
%\end{center}
\item Let $S$ be $s\Incl t\Seq s\Incl t$. The derivation in $NEQ_1$:\ \ \ 
\( \begin{array}{cl}
  \Seq t\Incl t & \raisebox{-1.2ex}[1.5ex][0ex]{(W)} \\ \cline{1-1}
  s\Incl t\Seq t\Incl t & \raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_s$)} \\ \cline{1-1}
  s\Incl t\Seq s\Incl t
\end{array} \)
\item Suppose that $NEQ_1$ proves the premises of \reff{ru:neqeq}. Weakening the
first premise with the formula $s=t$ allows us to get $s=t,\Gamma_s^x\Seq\Delta_s^x$ by
($=$) and ($cut$) with the second premise yields the conclusion of 
\reff{ru:neqeq} in $NEQ_1$:
\begin{center} \( \begin{array}{ccl}
 & \Gamma_t^x\Seq\Delta_t^x & \raisebox{-1.2ex}[1.5ex][0ex]{(W)} \\ \cline{2-2}
 & s=t,\Gamma_t^x\Seq\Delta_t^x & \raisebox{-1.2ex}[1.5ex][0ex]{($=$)} 
      \\ \cline{2-2}
\Gamma'\Seq s=t,\Delta' & s=t,\Gamma_s^x\Seq\Delta_s^x 
   & \raisebox{-1.2ex}[1.5ex][0ex]{($cut$)} \\ \cline{1-2}
\multicolumn{2}{c}{\Gamma_s^x,\Gamma'\Seq\Delta_s^x,\Delta'}
\end{array} \) \end{center}
\item An analogous procedure as above allows us to derive \reff{ru:neqincl} in $NEQ_1$
\end{LS}
\end{PROOF}

\begin{LEMMA}\label{neq1toneq} $NEQ_1 \Rightarrow NEQ$ \end{LEMMA}
\begin{PROOF}
\begin{LS}\MyLPar
\item The axiom \reff{ru:neq1tint} is $NEQ$ derivable by ($elim1$):
\prule{x\Incl t\Seq x\Incl t}{\Seq t\Incl t}
\item 
Both inference rules \reff{ru:K12} are derived by a 
single application of \reff{ru:neqeq}:

\prule{s=t,\Gamma_t^x\Seq\Delta_t^x\ \ ;\ \ s=t\Seq s=t}
      {s=t,\Gamma_s^x\Seq\Delta_s^x}
\item 
and the rule \reff{ru:Kincl} is obtained by an analogous application 
of \reff{ru:neqincl}.
\end{LS}
\end{PROOF}
The two lemmas yield:
\begin{LEMMA}\label{le:neqisneq1} $NEQ\equiv NEQ_1$.\end{LEMMA}

\section{$NEQ_2$ -- some restrictions on ($cut$) and ($elim1$).}
This section presents a new equivalent of $NEQ$ in which the general ($cut$) rule is
replaced by the {\em specific-cut rules} depending on the specific axioms
of the specification. Recall that we have fixed a set of axioms $\Ax$, of the 
general form \reff{ru:spax}: \(r_i \odot_i s_i \Seq u_j\odot_j v_j\).

\begin{DEFINITION} Calculus $NEQ_2$ is obtained from $NEQ_1$ by:
\begin{itemize}\MyLPar
\item[1.] replacing the inference rule \reff{ru:elim1} with:
\PROOFRULE{\Gamma,x\Incl t\Seq\Delta}{\Gamma\Seq\Delta_t^x}\ \ 
 ($E_s$)\ \ 
 $x\not\in\Vars(\Gamma,t)$ and at most one occurence of $x$ in
$\Delta$.
\item[2.]  adding the following inference rule for inclusion:
\PROOFRULE{s\Incl t,\Gamma, w(s)\preceq q\Seq\Delta}{s\Incl t,\Gamma,
w(t)\preceq q\Seq\Delta}
 \label{ru:Kincla} ($\Incl_a$)
%\ \ \ \  $x$ in $\Gamma$ isn't in the   RHS of $\Incl$;

(In the case of equality $w(s)=q$, we implicitly allow $q=w(t)$ in the conclusion.)
\item[3.] removing the cut-rule \reff{ru:neqcut};
\item[4.] replacing each specific axiom $\Ax_k$ of the form \reff{ru:spax} by 
the ($Sp.cut_k$) rule:
\PROOFRULE{\GSD,A_1\ ;\ ...\ ;\ \GSD,A_n\ ;\ B_1,\GSD\ ;\ ...\ ;\ B_m,\GSD
%\Gamma\Seq\Delta,A_1;\ \ ;\ \ u_j\odot_j v_j,\Gamma\Seq\Delta
} {\Gamma\Seq\Delta}
 \label{ru:spcut} ($Sp.cut_k$)
\end{itemize}
Formulae $\atom_i$ and $\batom_j$ in applications of ($Sp.cut$) will be 
called the {\em specific cut formulae}.
\end{DEFINITION} 
Before proving the equivalence of $NEQ_1$ and $NEQ_2^c$ we introduce the
following convention to be used extensively.

\begin{DEFINITION} In an application of a rule we distinguish the following
formulae:
\begin{itemize}\MyLPar
\item {\em active} -- the atomic formula explicitly mentioned in the premise(s)
and conclusion of the rule but not modified by its application;
\item {\em side} -- the formulae in the premise of the rule which are modified
(or removed) by its application;
\item {\em modified} -- the new formulae obtained in the conclusion of the rule
(either as the modified side formulae or as a new formulae introduced in the 
conclusion).\footnote{This is also called {\em principal}.}
\end{itemize}
\end{DEFINITION}
\noindent
The term which appears in a modified formula as a 
result of the application of the rule is called the {\em resulting
term}. Sometimes we will refer by ``modified'' to the term from the side
formula which was changed by the application of the rule, and by ``substituted'' to
this part of the resulting term which replaced a subterm of the modified term.

It is implicitly assumed that each rule modifies at most one term, even if
their formulation might indicate that several terms are modified
simultaneously (like for instance \reff{ru:neqeq} and \reff{ru:neqincl} in figure \ref{fi:neq}). This
convention is used throughout the whole paper.
\begin{EXAMPLE}
For instance, each of the weakening rules \reff{ru:weak}
has only one modified formula ($s\odot t$), and no side formula.
The ($cut$) rule \reff{ru:neqcut} has only side formula which is
also called the {\em cut} formula. The atom $s\odot t$ in the rules \reff{ru:K12}, 
\reff{ru:Kincl} is the active formula of these rules. 
Term $t$ is modified and $s$ substituted in
\reff{ru:K12} and in \reff{ru:Kincl}. The number of modified and side formulae in
these rules depends on the number of atoms in which $t$ is replaced by $s$. 
In the following application of ($elim1$) rule \reff{ru:elim1}
\begin{center}
\prule{\Gamma, \phi_x^x,x\Incl t\Seq\Delta}{\Gamma,\phi_t^x\Seq\Delta}
\end{center}
\noindent $\phi_t^x$ is the modified formula, $\phi_x^x, x\Incl t$ are side formulae, 
and $t$ is the substituted term.\\
We apply this notions in the top-down fashion, i.e., the formula above the
line will have a side formula, which is modified in the line below.
If one thinks of the bottom-up applications of the rules the notions remain the same but
what was ``modified'' in top-down will now be ``side'' and vice versa.
\end{EXAMPLE}

\noindent
We will also use following notions for a derivation $D$:
\begin{itemize}\MyLPar
\item the {\em height} of $D$, denoted $h(D)$, with the obvious meaning;
\item the {\em number of applications} of a rule $R$ in $D$, denoted $\#(R,D)$;
%\item the {\em grade of an application} of a rule $R$ in (a branch of) $D$ is
%the consequtive number of this application (in this branch) -- i.e., the first application has
%grade 1, the second 2, and so on;
%\item the {\em grade of a rule} $R$, denoted $gr(R,D)$, is the sum of the grades of all its
%applications in $D$.
\end{itemize}
%
\begin{LEMMA} $NEQ_1 \Rightarrow NEQ_2^c$.\end{LEMMA}
\begin{PROOF}
%\begin{LS}
%\item 
All specific axioms $\Ax$ are derivable in $NEQ_2$, using ($Sp.cut$) 
rules and derivability of the axiom $s\odot t\Seq s\odot t$ in $NEQ_2$. 

%\item 
The rule ($E_s$) is a restricted version of ($elim1$) when the modified
formula occurs in the succedent.
To see that ($elim1$) is derivable in $NEQ_2$, first observe 
that application of ($elim1$) with the modified 
formula in the succedent yields the same result as application of ($E_s$). 
So, consider an application of ($elim1$) with the modified formula in the 
antecedent. 
\begin{center}
\prule{\Gamma, s_x^x\preceq p, x\Incl t\Seq\Delta} 
  {\Gamma, s_t^x\preceq p \Seq\Delta}  ($elim1$)
\end{center}
By the restrictions on ($elim1$), $x$ occurs either in $=$ or in a LHS of $\Incl$,
which is indicated by the symbol $\preceq$. We may apply ($\Incl_a$) and 
($elim_s$) to obtain the same conclusion:
\[\begin{array}{cl}
\Gamma, s_x^x\preceq p, x\Incl t\Seq\Delta \\ \cline{1-1}
\Gamma, s_t^x\preceq p, x\Incl t\Seq\Delta
  & \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_a$)} \\ \cline{1-1}
\Gamma, s_t^x\preceq p\Seq\Delta
  & \raisebox{1.2ex}[1.5ex][0ex]{($E_s$)} 
\end{array} \] %\samepage
%\end{LS}       %\samepage
\end{PROOF} 

\begin{LEMMA} $NEQ_2^c \Rightarrow NEQ_1$.\end{LEMMA}
\begin{PROOF}
\begin{LS}
\item The ($Sp.cut$) rules \reff{ru:spcut} are derivable in $NEQ_1$.
For each ($Sp.cut_k$), use ($cut$) to its premises and the 
corresponding specific axiom $\Ax_k$.
\item  The rule \reff{ru:Kincla} ($\Incl_a$) is derivable in $NEQ_1$.
Assume that $NEQ_1$ proves the premise 
$s\Incl t,\Gamma^t_s\Seq\Delta$ of the rule and, for simplicity, 
consider only the case with one occurrence of $s$ in this premise, i.e., when
it has the form $s\Incl t, \phi_s^x,\Gamma_1\Seq\Delta$. 
The following is a derivation of
the conclusion of the rule in $NEQ_1$:
\[ \begin{array}{rcc}
\raisebox{-1.2ex}[1.5ex][0ex]{(W)} & \phi_t^x\Seq \phi_t^x &  \\ \cline{2-2}
\raisebox{-1.2ex}[1.5ex][0ex]{
$x$ not in the RHS of $\Incl$ in $\phi$\ \ ($\Incl_s$)} 
 & s\Incl t,\phi_t^x\Seq \phi_t^x & 
      \\ \cline{2-2}
 \raisebox{-1.2ex}[1.5ex][0ex]{($cut$)} 
& s\Incl t, \phi_t^x \Seq \phi_s^x & s\Incl t, \phi_s^x, \Gamma_1\Seq\Delta 
   \\ \cline{2-3}
& \multicolumn{2}{c}{\ \ \ \ \ s\Incl t,\phi_t^x,\Gamma_1\Seq\Delta}
\end{array} \]
%\[ \begin{array}{ccl}
% & \phi_t^x\Seq \phi_t^x & \raisebox{-1.2ex}[1.5ex][0ex]{(W)} \\ \cline{2-2}
% & s\Incl t,\phi_t^x\Seq \phi_t^x & \raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_s$) $x$
% not in the RHS of $\Incl$ in $\phi$} 
%      \\ \cline{2-2}
%s\Incl t, \phi_s^x, \Gamma_1\Seq\Delta & s\Incl t, \phi_t^x \Seq \phi_s^x 
%   & \raisebox{-1.2ex}[1.5ex][0ex]{($cut$)} \\ \cline{1-2}
%\multicolumn{2}{c}{s\Incl t,\phi_s^x,\Gamma_1\Seq\Delta}
%\end{array} \]
\end{LS}
\end{PROOF}
\noindent
The two lemmas yield:
\begin{LEMMA}\label{le:neq1isneq2} $NEQ_1 \equiv NEQ_2^c$.\end{LEMMA}
\noindent
Replacing each axiom of $NEQ_2$ of the form $a\Seq s$ by
the set of axioms $\Gamma,a \Seq\Delta, s$ for all $\Gamma, \Delta$, we can
remove the weakening rules. This simplifies the proofs, so from now on, we will use 
calculi without weakening. Nevertheless, it is often easier to understand the arguments if
the applications of weakening are made explicit. We will occasionally
formulate the proofs using such an explicit mention of weakening which is to
be understood as starting the whole derivation with another instance of the
same axiom -- in particular, it does not increase the height of the
derivation. More precisely, letting $NEQ_2^*$ denote $NEQ_2$ with axioms 
modified as indicated above and without the weakening rules, we have the following fact:

\begin{LEMMA}\label{le:noweak}
 $\der{NEQ_2}DS\ \impl\ \der{NEQ_2^*}{D^*}S$ and $h(D^*)\leq h(D)$.
\end{LEMMA}
\begin{PROOF}
We have to show that weakening rules are admissible in $NEQ_2^*$. Proceeding
by induction on the number of their applications and $h(D)$, consider the
last rule $R$ applied above weakening. The cases for ($W_a$) and ($W_s$) are
exactly the same, so we only formulate the proof for ($W_a$).
\begin{LS}
\item If no rules are applied above ($W_a$) in $D$, the result is an axiom
 $s\Seq s$ (with LHS possibly empty) of
 $NEQ_2$ weakened by a formula $\phi$. In $NEQ_2^*$ we obtain it directly as
 an axiom $\phi,s \Seq s$. The height of this new derivation is less then $h(D)$.
\item $R$ is ($=$), and $D$ ends as follows
\[ D \left \{ \begin{array}{rl}
 \multicolumn{1}{c}{\vdots} \\
 s=t, f(s)\odot q, \GSD \\ \cline{1-1}
 s=t, f(t)\odot q, \GSD & \rabove{(=)} \\ \cline{1-1}
 \phi, s=t, f(t)\odot q, \GSD & \rabove{(W)} \end{array} \right . \conv
%Obviously, we can swapp the two applications:
 \begin{array}{rl}
 \multicolumn{1}{c}{\vdots} \\
 s=t, f(s)\odot q, \GSD \\ \cline{1-1}
 \phi, s=t, f(s)\odot q, \GSD & \rabove{(W)} \\ \cline{1-1}
 \phi, s=t, f(t)\odot q, \GSD & \rabove{(=)} \end{array} \]
Induction hypothesis on $h(D)$ yields the conclusion.
\item The argument is exactly the same for all the remaining rules, with the
exception of the elimination rules.
\item $R$ is ($E_s$)
\[ D \left \{ \begin{array}{cl}
 D_1 \left \{ \begin{array}{rl}
 \multicolumn{1}{c}{\vdots} \\
 x\Incl t,  \GSD \\ \cline{1-1}
  \GSD_t^x & \rabove{(E_s)} \end{array} \right . \\ \cline{1-1}
 \phi[x], \GSD_t^x & \rabove{(W)} \end{array} \right . \]
If $\phi$ does not contain the eigen-variable $x$ of ($E_s$), we can
trivially swap the two. If it does, however, we have to rename $x$ in the
whole $D_1$ to a new variable, say $y$, not occuring there. We then obtain
equivalent derivation 
\[ D' \left \{ \begin{array}{cl}
 D_1' \left \{ \begin{array}{rl}
 \multicolumn{1}{c}{\vdots} \\
 y\Incl t,  \GSD \\ \cline{1-1}
  \GSD_t^y & \rabove{(E_s)} \end{array} \right . \\ \cline{1-1}
 \phi[x], \GSD_t^y & \rabove{(W)} \end{array} \right . \]
in which we can swap the applications of ($E_s$) and ($W$). \\
\item The same procedure is applied when the last rule was ($E_a$).
\end{LS}
\end{PROOF}

\section{Calculus $NEQ_3$}
In this section we modify the calculus obtaining $NEQ_3$ and prove
some lemmas leading to the specialisation of its rules, and calculus $NEQ_4$
to be studied in the following section.

In the following we will distinguish between the applications of rules with 
the modified formula occurring only in the antecedent or only in the succedent
of the conclusion. For instance, ($=_{a}$) will indicate that the application
of the rule ($=$) modified only some formulae in the antecedent, and similarly
for ($=_{s}$). We used this convention earlier, for instance, 
in the rules \reff{ru:Kincl}, \reff{ru:Kincla}
indicating by ($\Incl_s\setminus \Incl_a$) that only succedent$\setminus$antecedent
 of the premise was modified by the rule. (As before, we are glossing over the 
difference between $=_1$ and $=_2$.)

\begin{DEFINITION} Calculus $NEQ_3$ is obtained from $NEQ_2$ by:
\begin{itemize}\MyLPar
\item replacing weakening rules by extended axioms as indicated in lemma \ref{le:noweak};
\item replacing rules \reff{ru:K12} ($=$) by:
\PROOFRULE{s=t,\Gamma\Seq\Delta_t^x}{s=t,\Gamma\Seq\Delta_s^x} ($=_{s}$)
\label{ru:K12s} \ \ \ 
% \ \ \ \ \ \ \ \ 
%\prule{t=s,\Gamma\Seq\Delta_t^x}{t=s,\Gamma\Seq\Delta_s^x} ($=_{2s}$)\ \ \
and \\
\PROOFRULE{s=t,\Gamma_t^x\Seq\Delta}{s=t,\Gamma_s^x\Seq\Delta} ($=_{a}$)
\label{ru:K12a} 
%\ \ \ \ \ \ \ \ 
%\prule{t=s,\Gamma_t^x\Seq\Delta}{t=s,\Gamma_s^x\Seq\Delta} ($=_{2a}$)\ \ \
\item adding the inference rule of {\em simple cut}
\PROOFRULE{t\Incl t, \Gamma\Seq\Delta}{\Gamma\Seq\Delta} ($cut_t$)\label{ru:sicut}
%
%\item adding the following rule:
%\PROOFRULE{x\odot x,\Gamma\Seq\Delta}{\Gamma\Seq\Delta} \label{ru:cutx}($cut_x$)
%\ \ \ \ where: \(\odot\in\{=,\Incl\}\)
\end{itemize}
\end{DEFINITION}
\noindent
%Since the cases for $i=1,2$ are entirely symmetric, both for 
% $=_{ia}$ and $=_{is}$, we'll treat them uniformly and write only $=_a$,
% $=_s$.
The rules are shown in figure \ref{fi:neq3}.

\begin{figure}[hbt]
\hspace*{6em}\begin{tabular}{|lcl|}
\hline
\multicolumn{3}{|c|}{{\bf Axioms} :}\\[.5ex]
\multicolumn{3}{|c|}{$\GSD, p\Incl p$ \ \ \ \ \ \ \ $\GSD,x=x$ \ \ \ \ \ \ \
$\Gamma, s= t\Seq s= t, \Delta$ : $s,t\not\in\Vars$} \\[2ex]
%
\multicolumn{3}{|c|}{{\bf Identity rules} :}\\[.5ex]
\prule{s=t,\Gamma\Seq\Delta_t^x}{s=t,\Gamma\Seq\Delta_s^x} ($=_{s}$) & &
\prule{s=t,\Gamma_t^x,\Seq\Delta}{s=t,\Gamma_s^x,\Seq\Delta} ($=_{a}$) \\[3ex]
%
\multicolumn{3}{|c|}{{\bf Inclusion rules} :}\\[.5ex]
\prule{s\Incl t, \Gamma\Seq \Delta, w(t)\preceq q}{s\Incl t, \Gamma\Seq
\Delta, w(s)\preceq q} 
($\Incl_s$) & &
\prule{s\Incl t, w(s)\preceq q,\Gamma\Seq\Delta}{s\Incl t, w(t)\preceq q,\Gamma\Seq\Delta}
 ($\Incl_a$)\\[3ex]
%
\multicolumn{3}{|c|}{{\bf Elimination rules} :}\\[.5ex]
\prule{x\Incl t, \Gamma \Seq\Delta} 
  {\Gamma\Seq\Delta_t^x}  ($E_s$) & &
\prule{x\Incl t, y\Incl r(x), \Gamma\Seq\Delta}
  {y\Incl r(t),\Gamma\Seq\Delta}  ($E_a$) \\[1.5ex]
{\footnotesize \ \ \ - $x\not\in \Vars(\Gamma,t)$;} & & 
   {\footnotesize \ \ \ - $x$ is fresh $: x\not\in \C V(t,\Gamma,\Delta)$;} \\
{\footnotesize \ \ \ - at most one $x$ in $\Delta$;} & & 
   {\footnotesize \ \ \ - at most one $x$ in $r$ } \\[2ex]
%
\multicolumn{3}{|c|}{{\bf Specific cut rules} :}\\[.5ex]
\multicolumn{3}{|c|}
{for each specific axiom $\Ax_k$: \(\lis\atom\Seq \lism\batom{m}\), 
a  rule:}\\[1ex]
\multicolumn{3}{|c|}
{\prule{\Gamma\Seq\Delta,\atom_1\ ;...;\ \Gamma\Seq\Delta,\atom_n\ ;\ 
\batom_1,\Gamma\Seq\Delta\ ;...;\ \batom_m,\Gamma\Seq\Delta} 
{\Gamma\Seq\Delta}\ \ \ ($Sp.cut_k$)} \\[3ex]
%
\multicolumn{3}{|c|}{{\bf Simple cut} :}\\[.5ex]
\multicolumn{3}{|c|}{\prule{t\Incl t,\Gamma\Seq\Delta}{\Gamma\Seq\Delta}\ ($cut_t$)}\\
\hline
\end{tabular}
\caption{The rules of $NEQ_3$ ($x,y\in\Vars$).}\label{fi:neq3}
\end{figure}

\noindent
Any application of the equality rule \reff{ru:K12} in $NEQ_2$ can be simulated
by repeated applications of the rules \reff{ru:K12s} and \reff{ru:K12a}. 
Weakening rules are admissible in $NEQ_3$ according to lemma~\ref{le:noweak} and, in
the presence of the ($cut$) rule, the simple cut ($cut_t$) does not add anything to the
power of the calculus.
We thus have the obvious:
\begin{LEMMA}\label{le:neq2isneq3}
 $NEQ_2^c \equiv NEQ_3^c$.
\end{LEMMA}
%
\noindent
We will now specialize the rules of $NEQ_3$ by restricting the possible
applications of some of the rules.
%
\begin{DEFINITION}\label{de:eqALR}\label{de:eqSD}\label{de:inclad}\label{de:anr}
We distinguish following cases of applications of ($=_a$):
\begin{itemize}\MyLPar
\item ($=_{a=}$) when the side formula is equality;
\item ($=_{Ra}$) when the side formula is inclusion with RHS modified with
two subcases:
\begin{itemize}\MyLPar
\item {\em reduced} -- when the LHS of the modified formula is a
variable, i.e., \\
 ($=_{Rar}$)\ \ \prule{s=t, y\Incl p(t), \Gamma\Seq\Delta}{s=t, y\Incl p(s),
 \Gamma\Seq\Delta} \ $y\in\Vars$
\item ($=_{Ranr}$) {\em not reduced} -- otherwise;
\end{itemize}
\item ($=_{La}$) when the side formula is inclusion with LHS modified, with
two subcases:
\begin{itemize}\MyLPar
\item {\em reduced} -- the modified term being a variable, i.e., \\
  ($=_{Lar}$) \ \ \prule{y=t, s(y)\Incl p, \Gamma\Seq\Delta}{y=t, s(t)\Incl p,
 \Gamma\Seq\Delta}\ $y\in\Vars$
\item ($=_{Lanr}$) {\em not reduced} -- when $y$ is not a variable.
\end{itemize}
\end{itemize}
We distinguish two kinds of applications of ($=_s$):
\begin{itemize}\MyLPar
\item ($=_{Rs}$)  when the modified term is in a RHS of $\Incl$ -- we call
them {\em degenerate}, and
\item ($=_{sr}$) others, called {\em regular}.
\end{itemize}
We distinguish two kinds of applications of $(\Incl_a)$:
%\begin{itemize}\MyLPar
%\item ($\Incl_{ad}$) {\em degenerate} -- when the active formula has a variable in the RHS;
%\item ($\Incl_{arg}$) {\em regular} -- otherwise;
%\end{itemize}
%and furthermore
\begin{itemize}\MyLPar
\item  {\em reduced} -- when we replace a variable in the side formula:\\
 $(\Incl_{ar})$\ \ \prule{y\Incl t, w(y)\preceq q,\Gamma\Seq\Delta}{y\Incl t, w(t)\preceq q,\Gamma\Seq\Delta}
\label{ru:ar}\ \ \  $y\in \Vars$
\item {\em not reduced} $(\Incl_{anr})$ -- otherwise, i.e.,  when
$y\not\in\Vars$. 
%with the special subcase:
%\begin{itemize}\MyLPar
%\item ($\Incl_{ad}$) {\em degenerate} -- when $t\in\Vars$ and $y\not\in\Vars$.
%\end{itemize}
\end{itemize}
\end{DEFINITION}
\begin{REMARK}\label{re:notation}
Writing ($\preceq_a$), resp. ($\preceq_{anr}$), we will mean 
either ($\Incl_a$) or ($=_{La}$), resp. ($\Incl_{anr}$) or ($=_{Lanr}$).
In the proofs, the
 two cases are often treated analogously, and then this notation should be
 consistently replaced by either ($\Incl_a$) or by ($=_{La}$), unless we
 write some of the latter explicitly. 
However, in the side conditions like $\#(\preceq_a,D)$, we mean the {\em total number}
of applications of {\em both} rules.
\end{REMARK}
\noindent
We will show that undesirable -- degenerate/not reduced -- applications of rules
can be eliminated.
First we register a new rule which is admissible in $NEQ_3$.
%
\begin{LEMMA}\label{le:noeqeq}
 $\der{NEQ_3}DS\ \impl\ \der{NEQ_3}{D'}S$ and $D'$ contains no applications
 of ($=_{a=}$). Morover $\#(\preceq_a,D')\leq \#(\preceq_a,D)$,
and $\#(\preceq_{anr},D')\leq \#(\preceq_{anr},D)$.
\end{LEMMA}
\begin{PROOF}
By induction on $\#(=_{a=},D)$ and $h(D)$. Consider the uppermost application of
($=_{a=}$) and the rule $R$ applied just above it. (If there is no such rule,
just start with another axiom.) The elimination rules, ($\Incl_s$), ($Sp.cut$) and ($cut_t$) 
do not affect
the active or the principal formula of ($=_{a=}$) so these can be swapped
reducing the height at which the application of ($=_{a=}$) occurs. We have
then the following cases for $R$:
\begin{LS}
\item\label{it:cutt} ($=_{La}$):
\[ D \left\{ \begin{array}{rl}
 D_1 \left\{ \begin{array}{r}
\multicolumn{1}{c}{\vdots} \\
r=u, w(u)=t, s(w(u))\Incl p, \GSD \end{array} \right. \\ \cline{1-1}
r=u, w(u)=t, s(t)\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{La}$)} \\ \cline{1-1}
r=u, w(r)=t, s(t)\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)} 
\end{array} \right.
\convd
D' \left\{ \begin{array}{rl}
       D'_1\left\{ \begin{array}{r}
       \multicolumn{1}{c}{\vdots} \\
       u\Incl r,r=u, w(u)=t, s(w(u))\Incl p,  \GSD \end{array} \right . \\ \cline{1-1}
u\Incl r,r=u,w(u)=t, s(t)\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)}
\\ \cline{1-1}
u\Incl r,r=u,w(r)\Incl t,s(t)\Incl p,\GSD &\raisebox{1.2ex}[1.5ex][0ex]{($\Incl_a$)}
\\ \cline{1-1}
u\Incl u,r=u, w(r)\Incl t,s(t)\Incl p,\GSD &\raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)}
\\ \cline{1-1}
r=u,w(r)=t,s(t)\Incl p,\GSD & \raisebox{1.2ex}[1.5ex][0ex]{($cut_t$)}
\end{array} \right .
\]
\noindent
$D_1'$ is the same as $D_1$ weakened with $u\Incl r$, i.e., $h(D_1')=h(D_1)$, and so
application of ($=_{a=}$) can be eliminated by induction hypothesis yielding a derivation $D''$. 
In $D''$ we have an
application of ($\Incl_a$) instead of the application of ($=_{La}$) in $D$ so
 the total number $\#(\preceq_a,D'')\leq \#(\preceq_a,D)$.
Morover, if $u\not\in\Vars$ then also $w(u)\not\in\Vars$, i.e. if the original 
application of ($=_{La}$) was reduced, then so is the resulting ($\Incl_a$).
%
\item ($=_s$): The only case when simple swapping of the last two rules is
insufficient occurs when
the active formula of ($=_s$) is principal in the last application of
($=_{a=}$). 
The end of the derivation has then the form:
%
\[D \left\{ \begin{array}{cl}
%\vdots \\
s=t, w(t)=q,\Gamma \Seq \Delta, p(q)=r  & 
  \raisebox{-1.2ex}[1.5ex][0ex]{($=_s$)} \\ \cline{1-1}
s=t, w(t)=q,\Gamma \Seq \Delta, p(w(t))=r & 
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{a=}$)} \\ \cline{1-1}
s=t, w(s)=q, \Gamma \Seq\Delta, p(w(t))=r
\end{array} \right. \convd
%
%Nevertheless, swapping the applications of ($=_a$) and ($=_s$) we may obtain:
%
 D' \left \{ \begin{array}{cl}
D_1 \left\{ \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\
s=t, w(t)=q, \Gamma \Seq\Delta, p(q)=r  & 
  \raisebox{-1.2ex}[1.5ex][0ex]{($=_{a=}$)} \\ \cline{1-1}
s=t, w(s)=q,\Gamma \Seq\Delta, p(q)=r  & 
\end{array} \right.
\\ \cline{1-1}
s=t, w(s)=q, \Gamma \Seq\Delta, p(w(s))=r & \raisebox{1.2ex}[1ex][0ex]{($=_s$)} \\ \cline{1-1}
s=t, w(s)=q, \Gamma \Seq\Delta, p(w(t))=r & 
\raisebox{1.2ex}[1ex][0ex]{($=_s$)} 
\end{array}  \right . \]
%
$h(D_1) < h(D)$ so, by the induction hypothesis, there is a $NEQ_3$ derivation
corresponding to $D'$ deriving the same  sequent without ($=_{a=}$). 
The case when in  $D$, ($=_s$) replaces $w(t)$ by $q$ is treated analogously.
%
\item ($\Incl_a$):
\[D \left\{ \begin{array}{rl} D_1\left\{\begin{array}{c} \vdots \\
s=t, w(p)=q, p\Incl r(t),\Gamma \Seq \Delta \end{array}\right. & \\ \cline{1-1}
s=t, w(r(t))=q, p\Incl r(t),\Gamma \Seq \Delta  &   
         \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_a$)} \\ \cline{1-1}
s=t, w(r(s))=q, p\Incl r(t),\Gamma \Seq\Delta & \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)} 
\end{array} \right. \convd
%
%We construct $D'$:
D' \left\{ \begin{array}{rl} D'_1\left\{ \begin{array}{c} \vdots \\
s=t, w(p)=q, p\Incl r(t), p\Incl r(s),\Gamma \Seq \Delta\end{array}\right. \\ \cline{1-1}
s=t, w(r(s))=q, p\Incl r(t), p\Incl r(s), \Gamma \Seq \Delta  & 
   \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_a$)} \\ \cline{1-1}
s=t, w(r(s))=q, p\Incl r(t),p\Incl r(t),\Gamma \Seq\Delta  &
   \raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)}
\end{array} \right. \]
%
where the last sequent is the same as in $D$ by implicit contraction. The last sequent 
of $D'_1$ can be obtained as in $D_1$ by weakening (lemma~\ref{le:noweak})
with $h(D'_1)=h(D_1)$.
%
\item ($=_{Ra}$):
\[
\begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\
r=u, w(u)=t, p\Incl f(w(u)), \GSD \\ \cline{1-1}
r=u, w(u)=t, p\Incl f(t), \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)} \\ \cline{1-1}
r=u, w(r)=t, p\Incl f(t), \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)} \end{array}
\convd
\begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\
r=u, w(u)=t, p\Incl f(w(u)), \GSD \\ \cline{1-1}
r=u, w(r)=t, p\Incl f(w(u)), \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)} \\ \cline{1-1}
r=u, w(r)=t, p\Incl f(w(r)), \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)} \\ \cline{1-1}
r=u, w(r)=t, p\Incl f(t), \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)} 
\end{array}
\]
Analogous transformation is applied when ($=_{a=}$) modifies $t$ rather than $w(u)$.
\end{LS}
In all cases no new applications of ($\preceq_a$) appear in the transformed derivations 
$D'$, and the ones which occur there are the same as in the original derivations $D$.
\end{PROOF}
%
\begin{LEMMA}\label{le:noar}\label{le:noRanr} 
$\der{NEQ_3}DS\ \impl\ \der{NEQ_3}{D^*}S$
and $D^*$ contains no applications of ($\Incl_{anr}$) nor ($=_{Ranr}$).
Moreover, $\#(\preceq_a,D^*)\leq\#(\preceq_a,D)$ 
and $\#(\preceq_{anr},D^*)\leq\#(\preceq_{anr},D)$.
\end{LEMMA}
\begin{PROOF}
By lemma~\ref{le:noeqeq} we can assume that $D$ contains no applications of
($=_{a=}$). We first consider the case where the uppermost application of any of the
two rules is $(\Incl_{anr})$.

By induction on $\<\#(\Incl_{anr},D)+\#(=_{Ranr}),h(D)\>$.
%, where $n$ is the number of
%applications of ($\Incl_{anr}$) in $D$ and $h(D)$ is the height of $D$. 
The basis
case of $h(D)=1$ is trivial, since then the premise of the rule
would have to be an axiom and the rule is not applicable to any axiom of $NEQ_3$.
So, consider the uppermost application of ($\Incl_{anr}$) and the rule $R$ applied
immediately above it:
\[ q\notin \cal V\ \ \ \begin{array}{cl}
  \vdots & \raisebox{-1.2ex}[1.5ex][0ex]{$R$} \\ \cline{1-1}
  q\prec t,s(q)\preceq p,\Gamma\Seq\Delta &
  \raisebox{-1.2ex}[1.5ex][0ex]{($\prec_{anr}$)} \\ \cline{1-1}
  q\prec t,s(t)\preceq p,\Gamma\Seq\Delta &
\end{array} \]
%
%where $q\notin \cal V$.
\begin{LS}
\item $R$ is ($\preceq_s$) with the active formula $s(q)\preceq p$. 
  \[D \left\{ \begin{array}{cl}
%\vdots \\
 q\prec t,s(q)\preceq p,\Gamma \Seq \Delta,s_1(p)\preceq q_1  &
  \raisebox{-1.2ex}[1.5ex][0ex]{$(\preceq_s)$} \\ \cline{1-1}
 q\prec t,s(q)\preceq p,\Gamma \Seq \Delta, s_1(s(q))\preceq q_1  &
\raisebox{-1.2ex}[1.5ex][0ex]{$(\prec_{anr})$} \\ \cline{1-1}
 q\prec t,s(t)\preceq p,\Gamma \Seq\Delta, s_1(s(q))\preceq q_1
\end{array} \right. \]
If the active formula of ($\preceq_s$) does not contain $q$ in the way 
indicated above, the applications of ($\preceq_s$) and ($\Incl_{anr}$) can be
trivially swapped and the induction hypothesis allows to eliminate 
($\Incl_{anr}$). 

From the above  $D$, we may deduce the existence of the following derivation:
\[ \begin{array}{cl}
D_1\left\{
\begin{array}{cl}
%\vdots \\
 q\prec t,s(q)\preceq p,\Gamma \Seq \Delta,s_1(p)\preceq q_1
         & \raisebox{-1.2ex}[1.5ex][0ex]{$(\Incl_{anr})$} \\ \cline{1-1}
 q\prec t,s(t)\preceq p,\Gamma \Seq \Delta,s_1(p)\preceq q_1
\end{array} \right. \\ \cline{1-1}
 q\prec t,s(t)\preceq p,\Gamma \Seq \Delta, s_1(s(t))\preceq q_1
         & \raisebox{1.2ex}[1.5ex][0ex]{$(\preceq_s)$} \\ \cline{1-1}
 q\prec t,s(t)\preceq p,\Gamma \Seq \Delta, s_1(s(q))\preceq q_1
         & \raisebox{1.2ex}[1.5ex][0ex]{$(\preceq_s)$}
\end{array}  \]
Since $h(D_1) < h(D)$, the induction hypothesis allows us to eliminate 
($\Incl_{anr}$).
\item $R$ is ($E_a$). It follows from the definition \ref{de:anr} that
$q\not\in\cal V$ and hence $s(q)\not\in\cal V$. Therefore none of $q\Incl t$
and $s(q)\preceq p$ can be the modified formula of an application of ($E_a$).
Hence the two applications can be swapped and induction hypothesis applied.
%
\item\label{it:eqLa} $R$ is ($=_{La}$): %, i.e., ($=_{Lar}$):
\[ \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\
q'(u)\Incl t, s(q'(r))\preceq p, u=r, \Gamma\Seq\Delta \\ \cline{1-1}
q'(r)\Incl t, s(q'(r))\preceq p, u=r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(=_{La})$} \\ \cline{1-1}
q'(r)\Incl t, s(t)\preceq p, u=r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{anr})$}
\end{array} \convd
%Using weakening (another axiom) we construct the following derivation $D'$:
 \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\
q'(r)\Incl t, q'(u)\Incl t, s(q'(r))\preceq p, u=r, \Gamma\Seq\Delta \\ \cline{1-1}
q'(r)\Incl t, q'(u)\Incl t, s(t)\preceq p, u=r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{anr})$} \\ \cline{1-1}
q'(r)\Incl t, q'(r)\Incl t, s(t)\preceq p, u=r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(=_{La})$}
\end{array} \] 
Exactly analogous weakening is used when the modified formula of ($=_{La}$)
is the active formula of the subsequent application of ($\Incl_{anr}$).
%
\item $R$ is ($=_{Rar}$):
If the active formula of ($\Incl_{anr}$) is not modified by ($=_{Ra}$) we
obtain the required reduction in height by swapping analogous to the previous
case. So, assume it was modified. The derivation ends then as follows:
\[ \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\
t(y) \Incl q, y\Incl p(k), r=k, \Gamma\Seq\Delta \\ \cline{1-1}
t(y)\Incl q, y\Incl p(r), r=k, \Gamma\Seq\Delta &
\raisebox{1.2ex}[1.5ex][0ex]{$(=_{Rar})$} \\ \cline{1-1}
t(p(r))\Incl q, y\Incl p(r), r=k, \Gamma\Seq\Delta &
\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{a})$} 
\end{array} 
\]
Since we have ($=_{Rar}$), the LHS in $y\Incl p(k)$ must be a variable, which means 
that the final application is ($\Incl_{ar}$).
%WAS typo s for y:\conv
% \begin{array}{rl}
%t(s) \Incl q, y\Incl p(k), r=k, \Gamma\Seq\Delta \\ \cline{1-1}
%t(p(k))\Incl q, y\Incl p(k), r=k, \Gamma\Seq\Delta &
%\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{anr})$} \\ \cline{1-1}
%t(p(k))\Incl q, y\Incl p(r), r=k, \Gamma\Seq\Delta &
%\raisebox{1.2ex}[1.5ex][0ex]{$(=_{Rar})$} \\ \cline{1-1}
%t(p(r))\Incl q, y\Incl p(r), r=k, \Gamma\Seq\Delta & \rabove{(=_{Lanr})}
%\end{array} \]
\item $R$ is ($\Incl_{ar}$): This case is treated exactly as case \ref{it:eqLa} of
($=_{Lar}$) with the applications of ($\Incl_a$) instead:
\[ \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\
q'(x)\Incl t, s(q'(r))\preceq p, x\Incl r, \Gamma\Seq\Delta \\ \cline{1-1}
q'(r)\Incl t, s(q'(r))\preceq p, x\Incl r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$} \\ \cline{1-1}
q'(r)\Incl t, s(t)\preceq p, x\Incl r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{anr})$}
\end{array} \convd
%Using weakening (another axiom) we construct the following derivation $D'$:
 \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\
q'(r)\Incl t, q'(x)\Incl t, s(q'(r))\preceq p, x\Incl r, \Gamma\Seq\Delta \\ \cline{1-1}
q'(r)\Incl t, q'(x)\Incl t, s(t)\preceq p, x\Incl r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{anr})$} \\ \cline{1-1}
q'(r)\Incl t, q'(r)\Incl t, s(t)\preceq p, x\Incl r, \Gamma\Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$}
\end{array} \]
Analogous procedure yields the result if the modified formula of the
application of ($\Incl_{ar}$) is not side but active in the subsequent ($\Incl_{anr}$).
%
\item ($E_s$), ($Sp.cut$) and ($cut_t$) can be swapped with ($\Incl_{anr}$).
\end{LS}
Now the case when the uppermost application is of $(=_{Ranr})$
\begin{LS}
\item $R$ is ($=_{La}$) $D$ ends as follows
\[ \hspace*{-1.5em}  \begin{array}{rl} 
r=u, s=t, q(r)\Incl p(t), \GSD \\ \cline{1-1}
r=u, s=t, q(u)\Incl p(t), \GSD & \rabove{(=_{La})} \\ \cline{1-1}
r=u, s=t, q(u)\Incl p(s), \GSD & \rabove{(=_{Ranr})} \end{array} \conv
% \] Swapping, we get ($=_{Ranr}$) at a lower height: \[ 
\begin{array}{rl}
r=u, s=t, q(r)\Incl p(t), \GSD \\ \cline{1-1}
r=u, s=t, q(r)\Incl p(s), \GSD & \rabove{(=_{Ranr})} \\ \cline{1-1}
r=u, s=t, q(u)\Incl p(s), \GSD & \rabove{(=_{La})} \end{array} \]
%
\item $R$ is ($\Incl_{ar}$) The side formula of ($=_{Ranr}$) cannot be active
here, since we are using reduced version of ($\Incl_a$):
\[ \begin{array}{rl}
x\Incl u, s=t, q(x)\Incl p(t), \GSD \\ \cline{1-1}
x\Incl u, s=t, q(u)\Incl p(t), \GSD & \rabove{(\Incl_{ar})} \\ \cline{1-1}
x\Incl u, s=t, q(u)\Incl p(s), \GSD & \rabove{(=_{Ranr})} \end{array} \]
Again, swapping gives reduction of height:
\[ \begin{array}{rl}
x\Incl u, s=t, q(x)\Incl p(t), \GSD \\ \cline{1-1}
x\Incl u, s=t, q(x)\Incl p(s), \GSD & \rabove{(=_{Ranr})} \\ \cline{1-1}
x\Incl u, s=t, q(u)\Incl p(s), \GSD & \rabove{(\Incl_{ar})} \end{array} \]
%
\item $R$ is ($\Incl_{s}$)
\[ \begin{array}{rl}
s=t, q\Incl p(t), \GSD, w(p(t))\preceq r \\ \cline{1-1}
s=t, q\Incl p(t), \GSD, w(q)\preceq r & \rabove{(\Incl_s)} \\ \cline{1-1}
s=t, q\Incl p(s), \GSD, w(q)\preceq r & \rabove{(=_{Ranr})} \end{array} \]
We transform the derivation reducing the height of ($=_{Ranr}$):
\[ \begin{array}{rl}
s=t, q\Incl p(t), \GSD, w(p(t))\preceq r \\ \cline{1-1}
s=t, q\Incl p(s), \GSD, w(p(t))\preceq r & \rabove{(=_{Ranr})} \\ \cline{1-1}
s=t, q\Incl p(s), \GSD, w(p(s))\preceq r & \rabove{(=_{sr})} \\ \cline{1-1}
s=t, q\Incl p(s), \GSD, w(q)\preceq r & \rabove{(\Incl_s)} \end{array} \]
%
\item Other cases are trivial. \\
If $R$ is ($=_{Rar}$) or ($E_a$) then they do not affect the active or side
formula of ($=_{Ranr}$) since, otherwise, the LHS of the latter would have to
be a variable. \\
 ($=_s$), ($E_s$), ($Sp.cut$) and ($cut_t$) can be trivially swapped.
\end{LS}
As we can see, there are no new applications of ($\preceq_a$) and the ones
occurring in the transformed derivations are the same as the original ones. 
Hence $\#(\preceq_a,D^*)\leq\#(\preceq_a,D)$ and $\#(\preceq_{anr},D^*)\leq
\#(\preceq_{anr},D^*)$.
\end{PROOF}
%
%\newpage
\begin{LEMMA}\label{le:noLanr}
 $\der{NEQ_3}DS\ \impl\ \der{NEQ_3}{D'}S$ and $D'$ contains no
applications of ($=_{Lanr}$).
Moreover, $\#(\preceq_a,D')\leq\#(\preceq_a,D)$, and 
$\#(\preceq_{anr},D')\leq\#(\preceq_{anr},D)$.
\end{LEMMA}
\begin{PROOF}
By lemmas~\ref{le:noeqeq} and \ref{le:noar}, we assume that $D$ does not contain
any applications of ($=_{a=}$) or ($\Incl_{anr}$).
By induction on $\<\#(=_{Lanr},D),h(D)\>$. Consider the last rule above the
uppermost application of ($=_{Lanr}$). 
\begin{LS}
 \item ($\Incl_a$), i.e, ($\Incl_{ar}$). \\
The first case is when both ($\Incl_{ar}$)
and ($=_{Lanr}$) modify the same formula:
\[ D \left \{ \begin{array}{rl}
f(x)\Incl p, r=u, x\Incl s(u), \Gamma \Seq\Delta \\ \cline{1-1}
f(s(u))\Incl p, r=u, x\Incl s(u), \Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} \\ \cline{1-1}
f(s(r))\Incl p, r=u, x\Incl s(u), \Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($=_{Lanr}$)} \end{array} \right . \convd
%We transform it into :
 D' \left \{ \begin{array}{rl}
f(x)\Incl p, r=u, x\Incl s(u), x\Incl s(r), \Gamma \Seq\Delta \\ \cline{1-1}
f(s(r))\Incl p, r=u, x\Incl s(u), x\Incl s(r),\Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} \\ \cline{1-1}
f(s(r))\Incl p, r=u, x\Incl s(u), x\Incl s(u),\Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)} \end{array} \right . \]
\noindent
The other case is when the formula $\phi$ modified by ($=_{Lanr}$) in $D$ was active in the
preceding 
application of ($\Incl_a$). But in this case, since we only have reduced applications
($\Incl_{ar}$), $\phi$'s LHS must be a variable, so the application of ($=_{La}$) would not be
($=_{Lanr}$) but ($=_{Lar}$).
%
\item ($\Incl_s$): The two applications ($\Incl_s$)-($=_{Lanr}$) are easily
replaced by ($=_{Lanr}$)-($=_s$).
%
\item ($=_{Lar}$): 
% \[ D \left \{ \begin{array}{rl}
% q(s(y)) \Incl p, y=u, s(u)=r, \Gamma\Seq\Delta  \\ \cline{1-1}
% q(s(u)) \Incl p, y=u, s(u)=r, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}$)} \\ \cline{1-1}
% q(r) \Incl p, y=u, s(u)=r, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lanr}$)} \end{array} \right . \convd
%  D' \left \{ \begin{array}{rl}
% q(s(y)) \Incl p, y=u, s(u)=r, s(y)=r, \Gamma\Seq\Delta \\ \cline{1-1}
% q(r) \Incl p, y=u, s(u)=r, s(y)=r, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lanr}$)} \\ \cline{1-1}
% q(r) \Incl p, y=u, s(u)=r, s(u)=r, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)} \end{array} \right . \]
% OLD:
\[ D \left \{ \begin{array}{rl}
f(x)\Incl p, r=u, x= s(u), \Gamma \Seq\Delta \\ \cline{1-1}
f(s(u))\Incl p, r=u, x= s(u), \Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}$)} \\ \cline{1-1}
f(s(r))\Incl p, r=u, x= s(u), \Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($=_{Lanr}$)} \end{array} \right . \convd
%We transform it into :
 D' \left \{ \begin{array}{rl}
f(x)\Incl p, r=u, x= s(u), x=s(r),\Gamma \Seq\Delta \\ \cline{1-1}
f(s(r))\Incl p, r=u, x= s(u), x=s(r),\Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($=_{Lanr}$)} \\ \cline{1-1}
f(s(r))\Incl p, r=u, x= s(u), x=s(u),\Gamma \Seq\Delta  &
\raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)} \end{array} \right . \]
By induction hypothesis ($=_{Lanr}$) can be eliminated from $D'$, and by 
lemma \ref{le:noeqeq} $D'$ can be transformed so that it
does not contain ($=_{a=}$) and this transformation does not
introduce any additional applications of ($=_{Lanr}$).
%
\item Elimination rules are not relevant,
neither is ($Sp.cut$), and ($=_{Ra}$) and ($cut_t$) are trivially swapped.
\end{LS}
Visiting the resulting derivations we see that no new applications of
($\preceq_a$) or ($\preceq_{anr}$) emerge.
\end{PROOF}

\begin{LEMMA}\label{le:noeqSD}
 $\der{NEQ_3}DS\ \impl\ \der{NEQ_3}{D^*}S$, and $D^*$ contains no applications
 of ($=_{Rs}$). [$D^*$ does not introduce any new applications of ($E_s$) -- this
fact will be used in lemma~\ref{le:noErsd}.
Also $\#(\preceq_{anr},D^*)=0$ but this isn't crucial.]
%\leq\#(\preceq_{anr},D)$.
\end{LEMMA}
\begin{PROOF}
By lemmas~\ref{le:noeqeq}-\ref{le:noLanr} we may assume that $D$ contains no
applications of ($=_{a=}$), ($\Incl_{anr}$) or ($=_{Lanr}$).

By induction on $\<\#(=_{Rs},D),h(D)\>$.
Consider the uppermost application of ($=_{Rs}$) in $D$:
%
\[ \begin{array}{cl}
\vdots          & \raisebox{-1.2ex}[1.5ex][0ex]{$R$} \\ \cline{1-1}
r=s, \Gamma\Seq\Delta, q\Incl t(r) &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rs}$)} \\ \cline{1-1}
r=s, \Gamma\Seq\Delta, q\Incl t(s) 
\end{array} \]
%
\begin{LS}
\item\label{it:RsEs} $R=(E_s)$ with $q\Incl t(r)$ as the modified formula and $r$ as
modified term. We have two subcases corresponding to the situation when the
term $r'$ substituted by ($E_s$) for its eigen-variable is a subterm or
superterm of (or equal to) $r$. (When the two are independent, the case is
trivial.) 
\begin{LSA}
\item  $r'$ is a subterm of $r$,\\
 i.e., $t'(r')$ and $t(r)$ are identical with $r=f(r')$ and $t'(x)=t(f(x))$.
\[ D \left \{\begin{array}{cl}
%\vdots          \\
x\Incl r', f(r')=s, \GSD, q\Incl t(f(x)) & \raisebox{-1.2ex}[1.5ex][0ex]{($E_s$)} \\ \cline{1-1}
f(r')=s, \GSD, q\Incl t(f(r')) &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rs}$)} \\ \cline{1-1}
f(r')=s, \GSD, q\Incl t(s) 
\end{array} \right . \convd
%
 D' \left \{ \begin{array}{cl}
%\vdots          \\
x\Incl r', f(r')=s, f(x)=s, \Gamma\Seq\Delta,q\Incl t(f(x)) & \raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rs}$)} \\ \cline{1-1}
x\Incl r', f(r')=s, f(x)=s, \Gamma\Seq\Delta, q\Incl t(s) &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} \\ \cline{1-1}
x\Incl r', f(r')=s, f(r')=s, \Gamma\Seq\Delta, q\Incl t(s) &
\raisebox{-1.2ex}[1.5ex][0ex]{($E_s$)} \\ \cline{1-1}
f(r')=s, \Gamma\Seq\Delta, q\Incl t(s) 
\end{array} \right . \]
%
Induction hypothesis allows us to eliminate the application of ($=_{Rs}$)
from $D'$ since it occurs higher than in $D$.
%
\item $r'$ is a superterm of (or equal to) $r$,\\
i.e., $r'=f(r)$ and $t(x)=t'(f(x))$.
\[ D \left \{\begin{array}{cl}
%\vdots          \\
x\Incl f(r), r=s, \Gamma\Seq\Delta, q\Incl t'(x) & \raisebox{-1.2ex}[1.5ex][0ex]{($E_s$)} \\ \cline{1-1}
r=s, \Gamma\Seq\Delta, q\Incl t'(f(r)) &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rs}$)} \\ \cline{1-1}
r=s, \Gamma\Seq\Delta, q\Incl t'(f(s)) 
\end{array} \right . \convd
%
%Construct $D'$ without any application of ($=_{Rs}$):
 D \left \{\begin{array}{cl}
%\vdots          \\
x\Incl f(r), r=s, \Gamma\Seq\Delta, q\Incl t'(x) & \raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rar}$)} \\ \cline{1-1}
x\Incl f(s), r=s, \Gamma\Seq\Delta, q\Incl t'(x) &
\raisebox{-1.2ex}[1.5ex][0ex]{($E_s$)} \\ \cline{1-1}
r=s, \Gamma\Seq\Delta, q\Incl t'(f(s)) 
\end{array} \right . \]
The case when the modified term is substituted into LHS of $\Incl$ is treated
analogously.
\end{LSA}
%
\item $R=(\Incl_{ar})$ with the modified formula $r=s(v)$ and $v$ as the modified
term:
\[ D \left \{ \begin{array}{cl}
 D_1 \left \{ \begin{array}{c}
              \vdots       \\ 
              r=s(u), u\Incl v, \Gamma\Seq\Delta,q\Incl t(r) 
           \end{array} \right . 
         & \raisebox{-3.2ex}[1.5ex][0ex]{($\Incl_{ar}$)}  \\ \cline{1-1}
r=s(v), u\Incl v, \Gamma\Seq\Delta, q\Incl t(r) &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rs}$)} \\ \cline{1-1}
r=s(v), u\Incl v, \Gamma\Seq\Delta, q\Incl t(s(v)) 
\end{array} \right . \convd
%
%Construct the following derivation $D^*$:
%
 D^* \left \{ \begin{array}{cl}
 D' \left \{ \begin{array}{cl}
   D_1 \left \{ \begin{array}{cl}
\vdots       \\ 
r=s(u), u\Incl v, \Gamma\Seq\Delta,q\Incl t(r) 
 \end{array} \right . & \raisebox{-3.2ex}[1.5ex][0ex]{($W_a$)}  \\
 \cline{1-1}
r=s(u), r=s(v), u\Incl v, \Gamma \Seq \Delta, q\Incl t(r)
 & \raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rs}$)} \\ \cline{1-1}
r=s(u), r=s(v), u\Incl v, \Gamma\Seq\Delta, q\Incl t(s(v))  \end{array}
\right . &  \\ \cline{1-1}
r=s(v), r=s(v), u\Incl v, \Gamma\Seq\Delta, q\Incl t(s(v)) 
& \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} 
\end{array} \right . \]
 $h(D') < h(D)$, so $D^*$
 can be transformed into a desired derivation without ($=_{Rs}$). (Notice
 that the result of $D^*$ is the same as the result of $D$ by the implicit
 application of contraction.)
\item $R=(\Incl_s)$ :
\[ D \left \{ \begin{array}{cl}
 D_1 \left \{ \begin{array}{c}
              \vdots       \\ 
              r=s, q\Incl u, \Gamma\Seq\Delta, u\Incl t(r) 
           \end{array} \right . 
         & \raisebox{-3.2ex}[1.5ex][0ex]{($\Incl_s$)}  \\ \cline{1-1}
r=s, q\Incl u, \Gamma\Seq\Delta, q\Incl t(r) &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rs}$)} \\ \cline{1-1}
r=s, q\Incl u, \Gamma\Seq\Delta, q\Incl t(s) 
\end{array} \right . \convd
%
%Construct the following derivation $D^*$:
%
 D^* \left \{ \begin{array}{cl}
 D' \left \{ \begin{array}{cl}
   D_1 \left \{ \begin{array}{cl}
\vdots       \\ 
r=s, q\Incl u, \Gamma\Seq\Delta, u\Incl t(r) 
 \end{array} \right . & \raisebox{-3.2ex}[1.5ex][0ex]{($=_{Rs}$)}  \\
 \cline{1-1}
r=s, r=s(v), q\Incl u, \Gamma \Seq \Delta, u\Incl t(s) \end{array}
\right . &  \\ \cline{1-1}
r=s, q\Incl u, \Gamma\Seq\Delta, q\Incl t(s) 
& \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_s$)} 
\end{array} \right . \]
%
Since $h(D')<h(D)$, the induction hypothesis yields a desired derivation.
%
\item The other cases when $R$ is ($E_a$), ($=_{sr}$), ($=_{Ra}$), ($=_{La}$), 
($Sp.cut$) or ($cut_t$) can be trivially swapped 
with the application of ($=_{Rs}$) since they do not affect the active
equation nor the modified inclusion of ($=_{Rs}$).
%
\end{LS}
[As we see, $D^*$ involves applications of $E_s$ only in the case~\ref{it:RsEs} 
but they are the same as in the original derivation $D$. Also,
since $\#(\preceq_{anr},D)=0$ and no new such applications occurred, we do get
$\#(\preceq_{anr},D^*)=0$.]
\end{PROOF}
%
Finally, we need yet another special lemma allowing us to exclude the 
applications of the rules ($\Incl_s$) and ($=_s$) which perform substitution of a variable $y\in\Vars$:
\PROOFRULE{y\Incl t, \GSD, q(t)\preceq s}{y\Incl t, \GSD, q(y)\preceq s}\label{ru:inclsx} ($\Incl_{sx}$)\ \
\ $y\in\Vars$ \\
\PROOFRULE{y=t, \GSD, q(t)\preceq s}{y= t, \GSD, q(y)\preceq s}\label{ru:eqsx} ($=_{sx}$)\ \
\ $y\in\Vars$

We will treat these two rules quite similarly and refer to them jointly as ($\preceq_{sx}$).
\begin{LEMMA}\label{le:noInclsx}
 $\der{NEQ_{3}}DS\ \impl\ \der{NEQ_{3}}{D'}S$ and $D'$ contains no applications
 of ($\preceq_{sx}$). [Also $\#(\preceq_{anr},D')=0$ but this isn't crucial.]
%\leq\#(\preceq_{anr},D)$.
%\new{Moreover, $\#(\preceq_a,D')\leq\#(\preceq_a,D)$.}
\end{LEMMA}
\begin{PROOF}
By lemmas~\ref{le:noeqeq}-\ref{le:noRanr} we may assume that $D$ contains no
applications of ($=_{a=}$), ($\Incl_{anr}$), ($=_{Lanr}$), ($=_{Rs}$) or ($=_{Ranr}$).

We write the proof for ($\Incl_{sx}$) merely indicating the places where the
treatement of ($=_{sx}$) would differ.
By induction on $h(D)$, we consider the last rule $R$ applied above
($\Incl_{sx}$):
\[ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ \cline{1-1}
y\Incl t, \GSD, q(t)\preceq s & \rabove{R}\\ \cline{1-1}
y\Incl t, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})}
\end{array} 
\hspace*{2em}{\rm which\ abbreviates}\hspace*{2em}
 \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ \cline{1-1}
y\preceq t, \GSD, q(t)\preceq s & \rabove{R}\\ \cline{1-1}
y\preceq t, \GSD, q(y)\preceq s & \rabove{(\preceq_{sx})}
\end{array} 
\]
\begin{LS}
\item $R$ is ($E_s$):
The two cases here correspond to ($E_s$) introducing a $t'$ which is a superterm or a
subterm of (possibly equal to) $t$:
 \begin{LSA}
 \item $t'$ is $f(t)$ and the derivation looks as follows:
\[ \begin{array}{rl}
  x\Incl f(t), y\Incl t, \GSD, q(x)\preceq s \\ \cline{1-1}
               y\Incl t, \GSD, q(f(t))\preceq s & \rabove{(E_s)} \\ \cline{1-1}
               y\Incl t, \GSD, q(f(y))\preceq s & \rabove{(\Incl_{sx})} 
\end{array}
\convd
 \begin{array}{rl}
g(f(y))\Incl g(f(t)),  x\Incl f(t), y\Incl t, \GSD, q(x)\preceq s \\ \cline{1-1}
g(f(y))\Incl g(f(t)),  y\Incl t, \GSD, q(f(t))\preceq s & \rabove{(E_s)} \\ \cline{1-1}
g(f(y))\Incl g(f(t)),  y\Incl t, \GSD, q(f(y))\preceq s & \rabove{(\Incl_{s})\ \ {\rm active}\ g(f(y))\Incl g(f(t))} \\ \cline{1-1}
g(f(t))\Incl g(f(t)),  y\Incl t, \GSD, q(f(y))\preceq s & \rabove{(\Incl_{ar})} \\ \cline{1-1}
 y\Incl t, \GSD, q(f(y))\preceq s & \rabove{(cut_{t})} 
\end{array}
\]
The application of $(\Incl_s)$ is not $(\Incl_{sx})$ because $f(t)$ is a superterm of 
$t$, and hence $f(y)$ a superterm of $y$. If we had $(=_{sx})$ in the original derivation, i.e. $y=t$, the application $(\Incl_{ar})$ would be replaced by $(=_{Rar})$.
% WAS: 
% \conv
% \begin{array}{rl}
%   x\Incl f(t), y\Incl t, \GSD, q(x)\preceq s \\ \cline{1-1}
%   x\Incl f(y), y\Incl t, \GSD, q(x)\preceq s & \rabove{(\Incl_a^*)} \\ \cline{1-1}
%                y\Incl t, \GSD, q(f(y))\preceq s & \rabove{(E_s)} 
% \end{array}
% \]
\item 
$t$ is $f(t')$ (or identical to $t'$):
\[ \begin{array}{rl}
  x\Incl t', y\Incl f(t'), \GSD, q(f(x))\preceq s \\ \cline{1-1}
               y\Incl f(t'), \GSD, q(f(t'))\preceq s & \rabove{(E_s)} \\ \cline{1-1}
               y\Incl f(t'), \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} 
\end{array} \convd
%We can then construct alternative derivation weakened with $y\Incl f(x)$:
 \begin{array}{rl}
 y\Incl f(x), x\Incl t', y\Incl f(t'), \GSD, q(f(x))\preceq s \\ \cline{1-1}
 y\Incl f(x), x\Incl t', y\Incl f(t'), \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \\ \cline{1-1}
 y\Incl f(t'), y\Incl f(t'), \GSD, q(y)\preceq s & \rabove{(E_a)} 
\end{array} \]
The case of ($=_{sx}$) will be treated slightly differently here:
\[ \begin{array}{rl}
  x\Incl t', y= f(t'), \GSD, q(f(x))\preceq s \\ \cline{1-1}
               y= f(t'), \GSD, q(f(t'))\preceq s & \rabove{(E_s)} \\ \cline{1-1}
               y= f(t'), \GSD, q(y)\preceq s & \rabove{(=_{sx})} 
\end{array} \convd
%We can then construct alternative derivation weakened with $y\Incl f(x)$:
 \begin{array}{rl}
 y= f(x), x\Incl t', y= f(t'), \GSD, q(f(x))\preceq s \\ \cline{1-1}
 y= f(x), x\Incl t', y= f(t'), \GSD, q(y)\preceq s & \rabove{(=_{sx})} \\ \cline{1-1}
 y= f(t'),x\Incl t', y= f(t'), \GSD, q(y)\preceq s & \rabove{(\Incl_{ar})}  \\ \cline{1-1}
 y= f(t'), y= f(t'), \GSD, q(y)\preceq s & \rabove{(E_a)} 
\end{array} \]
 \end{LSA}
%
\item $R$ is ($=_s$):
Again we have two cases:
 \begin{LSA}
 \item ($=_s$), introduces a superterm of $t$:
\[ \begin{array}{rl}
y\Incl t, f(t)=v, \GSD, q(v)\preceq s \\ \cline{1-1}
y\Incl t, f(t)=v, \GSD, q(f(t))\preceq s & \rabove{(=_s)} \\ \cline{1-1}
y\Incl t, f(t)=v, \GSD, q(f(y))\preceq s & \rabove{(\Incl_{sx})} \end{array} \convd
%We may obtain the same result without application of ($\Incl_{sx}$):
 \begin{array}{rl}
f(y)=v, y\Incl t, f(t)=v, \GSD, q(v)\preceq s \\ \cline{1-1}
f(y)=v, y\Incl t, f(t)=v, \GSD, q(f(y))\preceq s & \rabove{(=_s)} \\ \cline{1-1}
f(t)=v, y\Incl t, f(t)=v, \GSD, q(f(y))\preceq s & \rabove{(\Incl_{ar})} \end{array} \]
%
For ($=_{sx}$) the last step would require application of ($=_{a=}$).
\item $(=_s$), introduces a subterm of $t$:
\[ \begin{array}{rl} 
y\Incl f(t'), t'=v, \GSD, q(f(v))\preceq s \\ \cline{1-1}
y\Incl f(t'), t'=v, \GSD, q(f(t'))\preceq s & \rabove{(=_s)} \\ \cline{1-1}
y\Incl f(t'), t'=v, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \end{array} \convd
%We obtain the result constructing the following derivation:
 \begin{array}{rl}
y\Incl f(v), y\Incl f(t'), t'=v, \GSD, q(f(v))\preceq s \\ \cline{1-1}
y\Incl f(v), y\Incl f(t'), t'=v, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \\ \cline{1-1}
y\Incl f(t'), y\Incl f(t'), t'=v, \GSD, q(y)\preceq s & \rabove{(=_{Rar})} \end{array} \]
 \end{LSA}
%
For ($=_{sx}$), we weaken with $y=f(v)$, and apply ($=_{a=}$) in the last step.
\item $R$ is ($\Incl_s$):
This case is entirely analogous to the previous one with ($=_s$) replaced by
($\Incl_s$). In the last line of second subcase, we use ($\Incl_a$) instead
of ($=_{Ra}$).
\item $R$ is ($=_{Rar}$):
\[ \begin{array}{rl}
 y\Incl f(t), t=u, \GSD, q(f(u))\preceq s \\ \cline{1-1}
 y\Incl f(u), t=u, \GSD, q(f(u))\preceq s & \rabove{(=_{Rar})} \\ \cline{1-1}
 y\Incl f(u), t=u, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \end{array} \convd
%Construct instead weakened derivation
 \begin{array}{rl}
 y\Incl f(t), y\Incl f(u), t=u, \GSD, q(f(u))\preceq s \\ \cline{1-1}
 y\Incl f(t), y\Incl f(u), t=u, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \\ \cline{1-1}
 y\Incl f(u), y\Incl f(u), t=u, \GSD, q(y)\preceq s & \rabove{(=_{Rar})} \end{array} \]
%
\item $R$ is ($=_{Lar}$):
Then the active formula must be an equality of two variables:
\[ \begin{array}{rl}
 x\Incl t, x=y, \GSD, q(t)\preceq s \\ \cline{1-1}
 y\Incl t, x=y, \GSD, q(t)\preceq s & \rabove{(=_{Lar})} \\ \cline{1-1}
 y\Incl t, x=y, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \end{array} \conv
%Trivially swapping we get:
 \begin{array}{rl}
 y\Incl t, x\Incl t, x=y, \GSD, q(t)\preceq s \\ \cline{1-1}
 y\Incl t, x\Incl t, x=y, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \\ \cline{1-1}
 y\Incl t, y\Incl t, x=y, \GSD, q(y)\preceq s & \rabove{(=_{Lar})} 
% y\Incl t, x=y, \GSD, q(y)\preceq s & \rabove{(=_s)} 
\end{array} \]
This and the previous case need no separate consideration for ($=_{sx}$)
since the rules do not modify an equality in the antecedent.
%
\item $R$ is ($\Incl_{ar}$): The significant case occurs when $y\Incl t$ was modified here:
\[ \begin{array}{rl}
 x\Incl t, x\Incl y, \GSD, q(t)\preceq s \\ \cline{1-1}
 y\Incl t, x\Incl y, \GSD, q(t)\preceq s & \rabove{(\Incl_{ar})} \\ \cline{1-1}
 y\Incl t, x\Incl y, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \end{array} \convd
%Weakening we obtain
 \begin{array}{rl}
 y\Incl t, x\Incl t, x\Incl y, \GSD, q(t)\preceq s \\ \cline{1-1}
 y\Incl t, x\Incl t, x\Incl y, \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \\ \cline{1-1}
 y\Incl t, y\Incl t, x\Incl y, \GSD, q(y)\preceq s & \rabove{(\Incl_{ar})}
 \end{array} \]
Exactly the same procedure for ($=_{sx}$).
%
\item $R$ is ($E_a$):
\[ \begin{array}{rl}
 x\Incl t, y\Incl f(x),  \GSD, q(f(t))\preceq s \\ \cline{1-1}
 y\Incl f(t),  \GSD, q(f(t))\preceq s & \rabove{(E_a)} \\ \cline{1-1}
 y\Incl f(t),  \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \end{array} \convd
%Again, by weakening
 \begin{array}{rl}
 x\Incl t, y\Incl f(x), y\Incl f(t), \GSD, q(f(t))\preceq s \\ \cline{1-1}
 x\Incl t, y\Incl f(x), y\Incl f(t), \GSD, q(y)\preceq s & \rabove{(\Incl_{sx})} \\ \cline{1-1}
 y\Incl f(t),  y\Incl f(t), \GSD, q(y)\preceq s & \rabove{(E_a)} \end{array}
 \]
This case does not apply when considering ($=_{sx}$).
%
\item ($Sp.cut$) or ($cut_t$) can be obviously swapped with ($\preceq_{sx}$).
\end{LS}
[Since $\#(\preceq_{anr},D)=0$ and no new such applications occurred, we do get
$\#(\preceq_{anr},D')=0$.]
\end{PROOF}
\noindent
%To ease the proof of the main lemma \ref{le:elcut}, we also register
%
\begin{REMARK}\label{re:noincrease}
Notice that all the lemmas \ref{le:noeqeq} through \ref{le:noInclsx} 
%(and hence also \ref{le:inclaad}) 
yield derivations without applications of the rules eliminated in the other
lemmas. 
%The cases where this is not immediately obvious, 
% like in lemma \ref{le:noar} for
% ($=_{Ra}$), where an additional application of ($=_{Lanr}$) was introduced,
% can be treated by later lemmas, to obtain such derivations. 
Also, and this will be of importance in lemma \ref{le:elcut}, 
lemmas~\ref{le:noeqeq}, \ref{le:noar} and \ref{le:noLanr}
neither introduce new applications of ($\Incl_{anr}$) and ($=_{Lanr}$), nor
increase the number of applications of ($\Incl_{ar}$) or ($=_{Lar}$).
I.e., using these lemmas we obtain derivations with the number
of applications of ($\preceq_a$) not greater than in the original derivations.
\end{REMARK}

\section{$NEQ_4$ and admissibility of ($cut$).}
%
\begin{DEFINITION}\label{de:neq4}
$NEQ_4$ is $NEQ_3$ with 
\begin{itemize}\MyLPar
\item rules restricted
according to the lemmas \ref{le:noeqeq} through \ref{le:noInclsx},
\item the rules ($=_{Lar}$) and ($\Incl_{ar}$) restricted by the additional requirement that 
$w(t)\not\in\Vars$, and
\item
with the simple cut rule \reff{ru:sicut} replaced by the rule of {\em elementary cut}
\PROOFRULE{x\Incl x, \Gamma\Seq\Delta}{\Gamma\Seq\Delta} ($cut_x$)\ \
\ $x\in\Vars$ \label{ru:cutx} 
\end{itemize}
\end{DEFINITION}
%
\noindent
For easier reference, we list the rules of the calculus $NEQ_4$ in figure
\ref{fi:neq4}.

\begin{figure}[hbt]
\hspace*{6em}\begin{tabular}{|l@{\ \ \ \ \ \ \ \ \ \ \ \ }ll|}
\hline
\multicolumn{2}{|c}{{\bf Axioms}:} & \\[1ex]
\multicolumn{3}{|c|}{$\Gamma\Seq\Delta,p\Incl p$;\ \ \ \ \ \ $\Gamma\Seq\Delta, x=x$;\ \ \
\ \ \ 
$\Gamma,s=t\Seq\Delta, s=t$ : $s,t\not\in\Vars$}\\[2ex]
%
\multicolumn{2}{|c}{{\bf Identity rules}:} & \\[1ex]
\prule{t=s,\Gamma\Seq\Delta, p(s)\preceq q}{t=s,\Gamma\Seq\Delta, p(t)\preceq q} ($=_{sr}$) & 
\prule{s=t, x\Incl p(s), \Gamma\Seq\Delta}{s=t, x\Incl p(t),\Gamma\Seq\Delta} ($=_{Rar}$) 
    & \\[2.5ex]
  {\footnotesize \ \ \ - $t\not\in\Vars$} & \prule{x=t, w(x)\Incl q,
\Gamma\Seq\Delta}{x=t, w(t)\Incl q,\Gamma\Seq\Delta} ($=_{Lar}$) & \\[2ex]
&  \multicolumn{2}{l|}{{\footnotesize \ \ \
 - $w(t)\not\in \Vars$}} \\[2ex]
%&  {\footnotesize \ \ \ - $x\in\Vars$} & \\[2ex]
%
\multicolumn{2}{|c}{{\bf Inclusion rules}:}
& \\[1ex]
\prule{t\Incl s, \Gamma\Seq \Delta, p(s)\preceq q}{t\Incl s, \Gamma\Seq
\Delta, p(t)\preceq q} 
($\Incl_s$) & 
\prule{x\Incl t, w(x)\preceq q, \Gamma\Seq\Delta}{x\Incl t, w(t)\preceq q, \Gamma\Seq\Delta}
 ($\Incl_{ar}$) & \\[2ex]
  {\footnotesize \ \ \ - $t\not\in\Vars$} 
&  \multicolumn{2}{l|}{{\footnotesize \ \ \
 - $w(t)\not\in \Vars$}} \\[2ex]
%
\multicolumn{2}{|c}{{\bf Elimination rules}:} & \\[1ex]
\prule{\Gamma, x\Incl t\Seq\Delta} 
  {\Gamma\Seq\Delta_t^x}  ($E_s$) & 
\multicolumn{2}{l|}{\prule{x\Incl t, y\Incl r(x), \Gamma\Seq\Delta}
  {y\Incl r(t),\Gamma\Seq\Delta}  ($E_a$)} \\[.5ex]
 {\footnotesize \ \ \ - $x\not\in \Vars(\Gamma,t)$} &  \multicolumn{2}{l|}{{\footnotesize \ \ \
 - $x\not\in \Vars(t,\Gamma,\Delta,y)$}} \\
 {\footnotesize \ \ \ - at most one $x$ in $\Delta$;} &  \multicolumn{2}{l|}{{\footnotesize \ \
 \ - at most one occurrence of $x$ in $r$ }} \\[2ex]
%
\multicolumn{3}{|c|}{{\bf Specific cut rules}:}\\
\multicolumn{3}{|c|}
{for each specific axiom $\Ax_k$: \(a_1,...,a_n\Seq s_1,...,s_m\), 
a  rule:}\\[1ex]
\multicolumn{3}{|c|}
{\prule{\Gamma\Seq\Delta,a_1\ ;...;\ \Gamma\Seq\Delta,a_n\ ;\ 
s_1,\Gamma\Seq\Delta\ ;...;\ s_m,\Gamma\Seq\Delta} 
{\Gamma\Seq\Delta}\ \ \ ($Sp.cut_k$)} \\[4ex]
\multicolumn{3}{|c|}{{\bf Elementary cut}:}\\[1ex]
\multicolumn{3}{|c|}{\prule{x\Incl x,
\Gamma\Seq\Delta}{\Gamma\Seq\Delta}\ \ ($cut_x$)}\\
 \hline
\end{tabular} 
\caption{The rules of $NEQ_4$ ($x,y\in\Vars$)}\label{fi:neq4}
\end{figure}

\begin{REMARK}\label{re:cutx}
Actually, a much more restricted
version of the elementary cut rule would be sufficient: 
\begin{center} \prule{x\Incl x,
x=p(r), \GSD}{x=p(r),\GSD} \end{center}
However, the more general formulation here makes
the proofs in this section easier, and the rule will be eliminated anyway in the
final version of the calculus in the next section.
\end{REMARK}
\noindent
Before proving that $NEQ_3^c \equiv NEQ_4^c$ and also $NEQ_3\equiv
NEQ_4$, we will use admissibility of the two rules.
%
\begin{LEMMA}\label{le:inclaad} The following rule is admissible in $NEQ_4$:
\PROOFRULE{s\Incl t, q\Incl t, \Gamma\Seq\Delta}{s\Incl t, q\Incl s,
\Gamma\Seq\Delta}\ $s\not\in\Vars$\ \ \ \ ($\Incl_a^*$) \\
Moreover, if $D^*$ is a derivation using the rule ($\Incl_a^*$) and $D$ is the corresponding
derivation not using this rule, then $\#(\preceq_a,D)\leq\#(\preceq_a,D^*)$, and
$\#(\preceq_{anr},D)\leq\#(\preceq_{anr},D^*)$. \\ 
%-- MOVED from NEQ-3: to be FIXED. New $\Incl_{ar}$ modifies something that disappears
%in case 2)
\end{LEMMA}
\begin{PROOF}
By induction on $\< \#(\Incl_a^*,D^*),h(D^*)\>$. Consider the rule
applied just above ($\Incl_a^*$).
\begin{LS}
\item ($\Incl_a$):
\[ \begin{array}{rl}
 s(y) \Incl t, q\Incl t, y\Incl p, \GSD \\ \cline{1-1}
 s(p) \Incl t, q\Incl t, y\Incl p, \GSD & \rabove{(\Incl_{ar})} \\
 \cline{1-1}
 s(p) \Incl t, q\Incl s(p), y\Incl p, \GSD & \rabove{(\Incl_a^*)}
 \end{array} \conv
%The applications may be swapped, when we weaken the derivation:
 \begin{array}{rl}
s(p)\Incl t, s(y)\Incl t, q\Incl t, y\Incl p, \GSD \\ \cline{1-1}
s(p)\Incl t, s(y)\Incl t, q\Incl s(p), y\Incl p, \GSD &
\rabove{(\Incl_a^*)} \\ \cline{1-1}
s(p)\Incl t, s(p)\Incl t, q\Incl s(p), y\Incl p, \GSD &
\rabove{(\Incl_{ar})} \end{array} \]
%
\item ($\Incl_s$): $q\not\in\Vars$
% -- if $s\in\Vars$ we get $\Incl_{sx}$
\[ \begin{array}{rl}
s\Incl t, q\Incl t, \GSD, w(t)\preceq p \\ \cline{1-1}
s\Incl t, q\Incl t, \GSD, w(q)\preceq p & \rabove{(\Incl_s)} \\
\cline{1-1}
s\Incl t, q\Incl s, \GSD, w(q)\preceq p & \rabove{(\Incl_a^*)} \end{array} \conv
%We just swap:
 \begin{array}{rl}
s\Incl t, q\Incl t, \GSD, w(t)\preceq p \\ \cline{1-1}
s\Incl t, q\Incl s, \GSD, w(t)\preceq p & \rabove{(\Incl_a^*)} \\
\cline{1-1}
s\Incl t, q\Incl s, \GSD, w(s)\preceq p & \rabove{(\Incl_s)} \\
\cline{1-1} 
s\Incl t, q\Incl s, \GSD, w(q)\preceq p & \rabove{(\Incl_s)} 
\end{array} \]
The obtained applications of $(\Incl_s)$ are not $(\Incl_{sx})$ -- the first
by restriction on $(\Incl_a^*)$ -- $s\not\in\Vars$, and the second since $q\not\in\Vars$.
\item ($E_a$):
\[ \begin{array}{rl}
x\Incl t, y\Incl r(x), s\Incl r(t), \GSD \\ \cline{1-1}
          y\Incl r(t), s\Incl r(t), \GSD  & \rabove{(E_a)} \\ \cline{1-1}
          y\Incl s, s\Incl r(t), \GSD  & \rabove{(\Incl_a^*)} \end{array}
  \conv
%Again, swapping after weakening, we reduce the height:
 \begin{array}{rl}
x\Incl t, y\Incl r(x), s\Incl r(t), s\Incl r(x),\GSD \\ \cline{1-1}
x\Incl t, y\Incl s, s\Incl r(t), s\Incl r(x),\GSD  & \rabove{(\Incl_a^*)} \\ \cline{1-1}
          y\Incl s, s\Incl r(t), s\Incl r(t),\GSD  & \rabove{(E_a)} \end{array} \]
%
We do exactly the same if ($E_a$) modifies the active (rather than the side)
formula of the application of ($\Incl_a^*$).
\item ($=_{Lar}$): 
\[ \hspace*{-2em}\begin{array}{rl}
s(x)\Incl t, q\Incl t, x=p, \GSD \\ \cline{1-1}
s(p)\Incl t, q\Incl t, x=p, \GSD & \rabove{(=_{Lar})} \\ \cline{1-1}
s(p)\Incl t, q\Incl s(p), x=p, \GSD & \rabove{(\Incl_a^*)} \end{array} \conv
%Swap the applications, and clean up:
\begin{array}{rl}
s(p)\Incl t,s(x)\Incl t, q\Incl t, x=p, \GSD \\ \cline{1-1}
s(p)\Incl t,s(x)\Incl t, q\Incl s(p), x=p, \GSD & \rabove{(\Incl_a^*)} \\ \cline{1-1}
s(p)\Incl t,s(p)\Incl t, q\Incl s(p), x=p, \GSD & \rabove{(=_{Lar})} \end{array}
% WAS: -- if $q\not\in\Vars$ we get $=_{Ranr}$
% \begin{array}{rl}
% s(x)\Incl t, q\Incl t, x=p, \GSD \\ \cline{1-1}
% s(x)\Incl t, q\Incl s(x), x=p, \GSD & \rabove{(\Incl_a^*)} \\ \cline{1-1}
% s(p)\Incl t, q\Incl s(x), x=p, \GSD & \rabove{(=_{Lar})} \\ \cline{1-1}
% s(p)\Incl t, q\Incl s(p), x=p, \GSD & \rabove{(=_{Ra?})} 
% \end{array}
\]
\item ($=_{Rar}$):
\[ \hspace*{-2em} \begin{array}{rl}
s\Incl t(p), x\Incl t(r), r=p, \GSD \\ \cline{1-1}
s\Incl t(p), x\Incl t(p), r=p, \GSD & \rabove{(=_{Rar})}\\ \cline{1-1}
s\Incl t(p), x\Incl s, r=p, \GSD & \rabove{(\Incl_a^*)} \end{array} \conv
%Weakening allows us to swap:
 \begin{array}{rl}
s\Incl t(r), s\Incl t(p), x\Incl t(r), r=p, \GSD \\ \cline{1-1}
s\Incl t(r), s\Incl t(p), x\Incl s, r=p, \GSD & \rabove{(\Incl_a^*)} \\ \cline{1-1}
s\Incl t(p), s\Incl t(p), x\Incl s, r=p, \GSD & \rabove{(=_{Rar})} \end{array} \]
%
\item The rules ($=_s$), ($E_s$) and ($cut_t$) can be trivially swapped, since they do
not affect the antecedent -- the active formula, which is either equality or
disappears, cannot be involved in the final application of ($\Incl_a^*$).
\end{LS}
We see that no new applications of ($\preceq_a$) appear in the transformed derivations 
$D$, and the ones which occur there are the same as in the original derivations $D^*$.
\end{PROOF}
%
%
\begin{LEMMA}\label{le:asinNEQ3}
The following rule is admissible in $NEQ_4$ under the same restrictions
as in $NEQ_3$ (i.e., without introducing new applications of ($\preceq_a$) or
($\preceq_{anr}$)): \\[1ex]
\hspace*{3em}
\prule{s=t,p(t)=r, \GSD}{s=t,p(s)=r, \GSD} ($=_{a=}$) \\[3ex]
\end{LEMMA}
\begin{PROOF}
The proof is
the same as the proof of lemma~\ref{le:noeqeq},
except for the case~\ref{it:cutt} where ($cut_t$) was used. Here we have a 
similar situation with the reduced application of ($=_{La}$):
\[ D \left\{ \begin{array}{rl}
 D_1 \left\{ \begin{array}{r}
\multicolumn{1}{c}{\vdots} \\
r=x, x=t, s(x)\Incl p, \GSD \end{array} \right. \\ \cline{1-1}
r=x, x=t, s(t)\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}$)} \\ \cline{1-1}
r=x, r=t, s(t)\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)} 
\end{array} \right.
\convd
D' \left\{ \begin{array}{rl}
       D'_1\left\{ \begin{array}{r}
       \multicolumn{1}{c}{\vdots} \\
       x\Incl t, r=x,x=t,s(x)\Incl p,\GSD \end{array} \right . \\ \cline{1-1}
x\Incl t, r=x, r=t,s(x)\Incl p,\GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{a=}$)}\\ \cline{1-1}
x\Incl t, r=x, r=t,s(t)\Incl p,\GSD &\raisebox{1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)}\\ \cline{1-1}
x\Incl r, r=x, r=t,s(t)\Incl p,\GSD &\raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)}\\ \cline{1-1}
x\Incl x, r=x, r=t,s(t)\Incl p,\GSD &\raisebox{1.2ex}[1.5ex][0ex]{($=_{Ra}$)}\\ \cline{1-1}
r=x, r=t, s(t)\Incl p,\GSD & \raisebox{1.2ex}[1.5ex][0ex]{($cut_x$)}
\end{array} \right .
\]
\noindent $h(D_1')< h(D_1)+1$ yields the conclusion. Exactly the same transformation is made when ($=_{a=}$) in $D$ modifies $t$. 
Since the transformation replaces an application of ($=_{Lar}$) by an application of 
($\Incl_{ar}$), we have the unchanged total number of applications of ($\preceq_{a}$).
\end{PROOF}
%
% We have the two obvious results
% \begin{LEMMA}\label{le:neq3toneq4}
%  $NEQ_3 \impl NEQ_4$
% \end{LEMMA}
%and

\begin{LEMMA}\label{le:neq3cisneq4c}
 $NEQ_3^c \equiv NEQ_4^c$
\end{LEMMA}
\begin{PROOF}
We only need to show admissibility in
$NEQ_4$ of the unrestricted rules ($=_{Lar}$) and ($\Incl_{ar}$).
Let's tag the applications of ($=_{Lar}$), resp. ($\Incl_{ar}$), in which $w(t)\in\Vars$ by
$\_^v$. 
\begin{LS}
\item\label{caseA} 
We show that ($=_{Lar}^v$) is admissible in $NEQ_4$. Its uppermost application 
must look like:
\[ \begin{array}{cl}
\vdots          & \raisebox{-1.2ex}[1.5ex][0ex]{$R$} \\ \cline{1-1}
x=y, x\Incl q, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Lar}^v$)} \\ \cline{1-1}
x=y, y\Incl q, \GSD
\end{array}
\]
where both $x,y\in\Vars$. For this reason, if the assumption of this last application is
an axiom, the axiomatic atom (i.e., $p\Incl p$, $x=x$ or $s=t$) occurs in $\Gamma\cup\Delta$. 
Hence, we can obtain the conclusion using another instance of the axiom.
The only problematic case of $R$ is when the $x\Incl q$  modified in ($=_{Lar}^v$) 
was active in $R$
\begin{LSA}
\item\label{ca:mod} ($\Incl_{ar}$). The cases when the side formula of this application 
had a variable and a non-variable term in LHS are
treated differently.
\begin{LSB}
\item single variable:
\[ \begin{array}{cl}
D \left \{ \begin{array}{cl} \vdots       \\
x=y, x\Incl q, x\Incl p,\GSD  & \raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} \\ \cline{1-1}
x=y, x\Incl q, q\Incl p, \GSD & \end{array} \right. \\ \cline{1-1}
x=y, y\Incl q, q\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}^v$)}
\end{array}
\convd
\begin{array}{cl}
D' \left\{ \begin{array}{r}
x=y, x\Incl q, x\Incl p, q\Incl p, \GSD \end{array} \right . \\ \cline{1-1}
x=y, y\Incl q, x\Incl p, q\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}^v$)} \\ \cline{1-1}
x=y, y\Incl q, x\Incl q, q\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_a^*$)} \\ \cline{1-1}
x=y, y\Incl q, x\Incl y, q\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_a^*$)} \\ \cline{1-1}
x=y, y\Incl q, x\Incl x, q\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Rar}$)} \\ \cline{1-1}
x=y, y\Incl q, q\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($cut_x$)} 
\end{array}
\]
$h(D')<h(D)$ allows us to eliminate the application of ($=_{Lar}^v$). 
By lemma~\ref{le:inclaad}
($\Incl_a^*$) uses exactly the same applications of
($=_{Lar}$) and ($\Incl_{ar}$) as in the original proof. Hence use of this rule here does not
cause any problems.
\item otherwise, it's even easier to reduce the height of application of ($=_{Lar}^v$)
\[ \begin{array}{cl} \hspace*{-1em}
x=y, x\Incl q, w(x)\Incl p,\GSD  &\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)}\\ \cline{1-1}
x=y, x\Incl q, w(q)\Incl p, \GSD &  \\ \cline{1-1}
x=y, y\Incl q, w(q)\Incl p, \GSD & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}^v$)} \\  \ 
\end{array}
\conv
\begin{array}{cl}
x=y, x\Incl q, w(x)\Incl p,\GSD  \\ \cline{1-1}
x=y, y\Incl q, w(x)\Incl p,\GSD  & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}^v$)} \\ \cline{1-1}
x=y, y\Incl q, w(y)\Incl p,\GSD  & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Lar}$)} \\ \cline{1-1}
x=y, y\Incl q, w(q)\Incl p,\GSD  & \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} 
\end{array}
\]
\end{LSB}
\item\label{caseAB} 
Other cases allow trivial swaps. If $R$ was ($=_{Lar}$) then $x\Incl q$ wasn't modified
since the application wasn't $\_^v$. 
$x=y$ and $x\Incl q$ could not be active in 
applications of ($=_{sr}$), resp. ($\Incl_s$) because of the restrictions on these rules.

($=_{Rar}$), elimination and (specific and elementary) cut rules can be obviously swapped.
\end{LSA}

\item
Now, we show admissibility of ($\Incl_{ar}^v$), assuming that ($=_{Lar}^v$) is not used.
The uppermost application is:
\[ \begin{array}{cl}
\vdots          & \raisebox{-1.2ex}[1.5ex][0ex]{$R$} \\ \cline{1-1}
x\Incl y, x\preceq q, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}^v$)} \\ \cline{1-1}
x\Incl y, y\preceq q, \GSD
\end{array}
\]
As in \ref{caseA}, if the assumption of this last application is an axiom
so is the conclusion. 
\begin{LSA}
\item $R$ is ($=_{Lar}$). Neither $x\Incl y$ nor $x\preceq q$ can be modified here (by 
previous case \ref{caseA}), so $x=q$ must have been active. We have the two cases
analogous to \reff{ca:mod}:
\begin{LSB}
\item ($=_{Lar}$): the LHS of the side formula was a single variable:
\[ \begin{array}{cl} \hspace*{-1em}
x\Incl y, x=q, x\Incl p,\GSD    & \raisebox{-1.2ex}[1.5ex][0ex]{($=_{Lar}$)} \\ \cline{1-1}
x\Incl y, x=q, q\Incl p, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}^v$)} \\ \cline{1-1}
x\Incl y, y=q, q\Incl p,\GSD \\ \ 
\end{array}
\conv
\begin{array}{cl}
q\Incl p, x\Incl y, x=q, x\Incl p,\GSD    & \raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}^v$)} \\ \cline{1-1}
q\Incl p, x\Incl y, y=q, x\Incl p, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_a^*$)} \\ \cline{1-1}
q\Incl p, x\Incl y, y=q, x\Incl q, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Rar}$)} \\ \cline{1-1}
q\Incl p, x\Incl y, y=q, x\Incl y, \GSD &
\end{array}
\]
\item otherwise
\[ \begin{array}{cl} \hspace*{-1em}
x\Incl y, x=q, w(x)\Incl p,\GSD  & \raisebox{-1.2ex}[1.5ex][0ex]{($=_{Lar}$)} \\ \cline{1-1}
x\Incl y, x=q, w(q)\Incl p, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}^v$)} \\ \cline{1-1}
x\Incl y, y=q, w(q)\Incl p,\GSD \\  \ 
\end{array}
\conv
 \begin{array}{cl}
x\Incl y, x=q, w(x)\Incl p,\GSD  & \raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}^v$)} \\ \cline{1-1}
x\Incl y, y=q, w(x)\Incl p, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} \\ \cline{1-1}
x\Incl y, y=q, w(y)\Incl p, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($=_{Lar}$)} \\ \cline{1-1}
x\Incl y, y=q, w(q)\Incl p, \GSD &
\end{array}
\]
In both cases, the application of ($\Incl_{ar}^v$) after the transformation occurs higher 
than it did before.
\end{LSB}
\item $R$ was ($\Incl_{ar}$). Again, none of the formulae $x\Incl y$ or $x\preceq q$ could 
have been modified, since the application wasn't $\_^v$. Thus we have the situation (again
there are the same two cases, but we only show the more complicated one):
\[ \begin{array}{cl} \hspace*{-1em}
x\Incl y, x\Incl q, x\Incl p,\GSD    & \raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} \\ \cline{1-1}
x\Incl y, x\Incl q, q\Incl p, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}^v$)} \\ \cline{1-1}
x\Incl y, y\Incl q, q\Incl p,\GSD \\  \ 
\end{array}
\conv
\begin{array}{cl}
q\Incl p, x\Incl y, x\Incl q, x\Incl p,\GSD    & \raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{ar}^v$)} \\ \cline{1-1}
q\Incl p, x\Incl y, y\Incl q, x\Incl p, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{a}^*$)} \\ \cline{1-1}
q\Incl p, x\Incl y, y\Incl q, x\Incl q, \GSD &
\raisebox{-1.2ex}[1.5ex][0ex]{($\Incl_{a}^*$)} \\ \cline{1-1}
q\Incl p, x\Incl y, y\Incl q, x\Incl y, \GSD &
\end{array}
\]
\item All other rules can be trivially swapped for the similar reasons as in 
case \ref{caseAB}.
\end{LSA}
\end{LS}
\end{PROOF}
%

\noindent
The appplications of ($E_s$) and ($E_a$) with variable in the RHS
of the active formula, and those of ($E_s$) where the modified term is 
a variable making up a {\em whole} RHS of an inclusion will be called {\em degenerate}:
\begin{itemize}\MyLPar
\item $(E_{ad})$\ \ \prule{\Gamma,x\Incl z, y\Incl r(x)\Seq\Delta}{\Gamma,
y\Incl r(z)\Seq\Delta}\ \
 $z\in\Vars$\ \ \ \ ($r(x)=x$ is a special case)
\item $(E_{sd})$\ \ \prule{\Gamma,x\Incl z\Seq\Delta}{\Gamma\Seq\Delta_z^x}\ \
 $z\in\Vars$
\item $(E_{Rsd})$\ \ \prule{\Gamma,x\Incl t\Seq\Delta,p\preceq x}{\Gamma\Seq\Delta,p\preceq t}
\end{itemize}
We will show that they are redundant in $NEQ_4$. We show first redundancy
of ($E_{ad}$) and ($E_{sd}$), while the last one is postponed to lemma~\ref{le:noErsd}.

\begin{LEMMA}\label{le:noEad}
 $\der{NEQ_4}DS\ \impl\ \der{NEQ_4}{D'}S$ and $D'$ uses no applications of ($E_{ad}$).
\end{LEMMA}
\begin{PROOF}
Consider the uppermost application of ($E_{ad}$).
Renaming the eigen-variable $z$ in the whole $D_1$ to $x$, and applying ($cut_x$)
to the result of $D_1'$, we get the desired result. (Remember that we may have $r(z)=z$.)
\[ \begin{array}{cl}
D_1 \left \{ \begin{array}{c}
 \vdots \\
 z\Incl x, y\Incl r(z), \Gamma\Seq\Delta \end{array} \right . \\ \cline{1-1}
 y \Incl r(x), \Gamma\Seq\Delta & \raisebox{1.2ex}[1.5ex][0ex]{$(E_{ad})$}
\end{array} 
\conv
\begin{array}{cl}
D_1' \left \{ \begin{array}{c}
 \vdots \\
 x\Incl x, y\Incl r(x), \Gamma\Seq\Delta \end{array} \right . \\ \cline{1-1}
 y \Incl r(x), \Gamma\Seq\Delta & \raisebox{1.2ex}[1.5ex][0ex]{$(cut_x)$}
\end{array} \]
\end{PROOF}
%
\begin{LEMMA}\label{le:noEsd} 
$\der{NEQ_4}DS\ \impl\ \der{NEQ_4}{D^*}S$
and $D^*$ contains no applications of ($E_{sd}$).
\end{LEMMA}
\begin{PROOF}
By induction on the number of applications of ($E_{sd}$) in a given
derivation $D$. Consider the uppermost application:
\[ \begin{array}{cl}
D\left\{ \begin{array}{c}
 \vdots \\
 \Gamma,x\Incl y\Seq\Delta \end{array} \right. \\ \cline{1-1}
 \Gamma\Seq\Delta_y^x  &  \raisebox{1.2ex}[1.5ex][0ex]{($E_{sd}$)}
\end{array} \]
In all applications of ($E_s$) and ($E_a$) in $D$, replace the
eigen-variables so that they differ from the eigen-variable $x$. In the obtained
derivation, replace so all the occurrences of $x$ by $y$. In this way, we 
obtain a derivation of the sequent $\Gamma,y\Incl y\Seq\Delta_y^x$. 
Application of ($cut_x$) gives the desired derivation $D^*$ of the
sequent $\Gamma\Seq\Delta_y^x$ 
without using degenerated applications of ($E_{sd}$).
\end{PROOF}
%
\begin{LEMMA} \label{le:noxx}
 $\der{NEQ_4}{D}{x=x,\Gamma\Seq\Delta} \ \  \Rightarrow \ \ 
\der{NEQ_4}{}{\Gamma\Seq\Delta}$.\end{LEMMA}
\begin{PROOF} 
By induction on $h(D)$. Instead of any axiom with $x=x$ in the antecedent, we may
take the one without it. 
Consider the last rule applied before the appearance
of $x=x$, i.e., when it was the modified formula. 
($=_{a=}$) does not belong to $NEQ_4$, so the only possibility is
($\Incl_{ar}$). 
However, by its restriction, the term resulting from its application cannot be a variable
(cf. lemma~\ref{le:neq3cisneq4c}). Thus the lemma follows trivially.
(We are using here the restriction $w(t)\not\in\Vars$ on ($=_{Lar}$) making it impossible
for this rule to introduce $x=x$.)
% 
% We consider the rule $R$ applied before that which, again,
% can only be ($\Incl_{ar}$). We have two cases depending on whether the
% modified formula of this last but one application is also \ref{ca:yzmod} modified by the
% last one or else is \ref{ca:yzact} active there.
% \begin{LS}
% \item\label{ca:yzmod} $x=x$ is modified twice:
% \[ D \left \{ \begin{array}{rl}
% \multicolumn{1}{c}{\vdots} \\
% y=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta \\ \cline{1-1}
% z=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta & \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$}\\ \cline{1-1}
% x=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$} \end{array} \right . \convd
%  \begin{array}{cl} D' \left \{ \begin{array}{rl}
% \multicolumn{1}{c}{\vdots} \\
% y\Incl x, y=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta \\ \cline{1-1}
% y\Incl x, x=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$}
% \end{array} \right . \\ \cline{1-1}
% x=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{a}^*)$}
% \end{array} \]
% and eliminate $x=x$ by induction hypothesis since $h(D')<h(D)$.\\[1ex]
% \item\label{ca:yzact} $x=x$ was active before being modified. 
% Just like in the previous case:
% \[ D \left \{ \begin{array}{rl}
% \multicolumn{1}{c}{\vdots} \\
% z=x, y\Incl x, y\Incl z, \Gamma\Seq\Delta \\ \cline{1-1}
% z=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta & \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$}\\ \cline{1-1}
% x=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$} \end{array} \right . %\]
% \convd  %\[ 
% \begin{array}{cl} D' \left \{ \begin{array}{rl}
% \multicolumn{1}{c}{\vdots} \\
% z\Incl x, z=x, y\Incl x, y\Incl z, \Gamma\Seq\Delta \\ \cline{1-1}
% z\Incl x, x=x, y\Incl x, y\Incl z, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{ar})$}
% \end{array} \right . \\ \cline{1-1}
% x=x, z\Incl x, y\Incl z, \Gamma\Seq\Delta &
% \raisebox{1.2ex}[1.5ex][0ex]{$(\Incl_{a}^*)$}
% \end{array} \]
% \end{LS}
% In both cases, lemma~\ref{le:asinNEQ3} admits ($\Incl_a^*$).
\end{PROOF}


\begin{LEMMA}\label{le:nott} $\der{NEQ_4}D{t\Incl t,\Gamma\Seq\Delta}  
\ \ \Rightarrow \ \ \der{NEQ_4}{D^*}{\Gamma\Seq\Delta}$
%, and $D^*$ does not use ($E_{sd}$) if $D$ does not use it.
\end{LEMMA}
\begin{PROOF} 
By induction on $\<\gamma[t],h(D)\>$, where $\gamma[t]$ is the complexity of 
the term $t$ (defined in the usual way). 
If $\gamma[t]=0$, i.e., $t$ is a variable $x$,  application of ($cut_x$) yields the conclusion.

So let $\gamma[t]>0$ and $R$ be the last rule applied.
 The only rules which may generate $t\Incl t$ in the antecedent
are ($\Incl_{ar}$), ($E_a$) and ($=_a$), i.e., ($=_{Rar}$) or
($=_{Lar}$). We consider these cases by looking at the rule $R_1$ applied just above
%
\begin{LS}
\item $R$ is ($\Incl_{ar}$) and $D$ ends as shown below, where $t$ is $t(s)$:
\[ D \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ \cline{1-1}
t(y)\Incl t(s), y\Incl s, \Gamma\Seq\Delta & \rabove{R_1} \\ \cline{1-1}
t(s) \Incl t(s), y\Incl s, \GSD & \rabove{(\Incl_a)} \end{array} \right .\]
%
\begin{LSA}
\item $R_1$ is ($\Incl_{ar}$): The two possibilities are that $t(y)\Incl t(s)$ was
\ref{it:tact}) active
or \ref{it:tmod}) modified in $R_1$. The former requires $t(y)$ to be the variable
 $y$ and so $t(s)$ to be $t$.
\begin{LSB}
\item\label{it:tact} $y\Incl t$ was active:
\[ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ 
y\Incl t, y\Incl t, q(y)\preceq p, \Gamma\Seq\Delta  \\ \cline{1-1}
y\Incl t, y\Incl t, q(t)\preceq p, \Gamma\Seq\Delta & \rabove{(\Incl_{ar})} \\ \cline{1-1}
t\Incl t, y\Incl t, q(t)\preceq p, \GSD & \rabove{(\Incl_{ar})} \end{array} \]
Obviously, swapping the two applications gives a derivation with an earlier
appearance of $t\Incl t$. 
%
\item\label{it:tmod} $y\Incl t$ was modified (we write it here in full as $t(y)\Incl t(p(q))$):
\[ D \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ 
y\Incl p(x), t(y)\Incl t(p(q)), x\Incl q, \GSD \\ \cline{1-1}
y\Incl p(x), t(p(x))\Incl t(p(q)), x\Incl q, \GSD & \rabove{(\Incl_{ar})} \\ \cline{1-1}
y\Incl p(x), t(p(q))\Incl t(p(q)), x\Incl q, \GSD & \rabove{(\Incl_{ar})} \end{array} \right
.\]
We first use a weakened derivation with $y\Incl p(q)$
\[ \begin{array}{cl}
 D_1 \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ 
y\Incl p(q), y\Incl p(x), t(y)\Incl t(p(q)), x\Incl q, \GSD \\ \cline{1-1}
y\Incl p(q), y\Incl p(x), t(p(q))\Incl t(p(q)), x\Incl q, \GSD & \rabove{(\Incl_{ar})} 
 \end{array} \right . \\ \cline{1-1}
p(x) \Incl p(q), y\Incl p(x), t(p(q))\Incl t(p(q)), x\Incl q, \GSD &
\rabove{(\Incl_{ar})}  \\ \cline{1-1}
p(q) \Incl p(q), y\Incl p(x), t(p(q))\Incl t(p(q)), x\Incl q, \GSD &
\rabove{(\Incl_{ar})} \end{array} \]
By induction on $h(D_1)<h(D)$ we can obtain the sequent concluding $D_1$ without
 $t(p(q))\Incl t(p(q))$.
Then, the final $p(q)\Incl p(q)$, can be eliminated by induction hypothesis
on complexity of terms, since $\gamma[p(q)]< \gamma[t(p(q))]$.
\end{LSB}
%
\item $R_1$ is ($E_a$):
\[ \begin{array}{rl}
x\Incl p, y\Incl t(x), y\Incl t(p), \GSD \\ \cline{1-1}
 y\Incl t(p), y\Incl t(p), \GSD & \rabove{(E_a)} \\ \cline{1-1}
 t(p)\Incl t(p), y\Incl t(p), \GSD & \rabove{(\Incl_{ar})} \end{array} \convd
%Weaken the derivation as follows:
 \begin{array}{rl}
x\Incl p, y\Incl t(x),    y\Incl t(p), y\Incl t(x),\GSD \\ \cline{1-1}
x\Incl p, t(x)\Incl t(x), y\Incl t(p), y\Incl t(x),\GSD & \rabove{(\Incl_{ar})} \\ \cline{1-1}
 t(x)\Incl t(x), y\Incl t(p), y\Incl t(p),\GSD & \rabove{(E_a)} \end{array} \]
Induction on height gives the conclusion (having eliminated $t(x)\Incl t(x)$
the application of ($E_a$) becomes correct).
%
\item $R$ is ($=_{Rar}$):
\[ \begin{array}{rl}
 y\Incl t(s), y\Incl t(p), p=s, \GSD \\ \cline{1-1}
 y\Incl t(p), y\Incl t(p), p=s, \GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
 t(p)\Incl t(p), y\Incl t(p), p=s, \GSD & \rabove{(\Incl_{ar})} \end{array} \]
Weakening the derivation  with $y\Incl t(s)$ (if $\gamma[t(s)]<\gamma[t(p)]$,
and with $y\Incl t(p)$ otherwise), we obtain:
\[ \begin{array}{rl}
y\Incl t(s), y\Incl t(s), y\Incl t(p), p=s, \GSD \\ \cline{1-1}
 t(s)\Incl t(s), y\Incl t(s), y\Incl t(p), p=s, \GSD & \rabove{(\Incl_{ar})} \\ \cline{1-1}
 t(s)\Incl t(s), y\Incl t(p), y\Incl t(p), p=s, \GSD & \rabove{(=_{Rar})} \end{array} \]
Induction on height gives the conclusion. 
%
\item $R$ is ($=_{Lar}$):
\[ D \left \{ \begin{array}{rl}
t(x)\Incl t(s(p)), x=s(y), y\Incl p, \GSD \\ \cline{1-1}
t(s(y))\Incl t(s(p)), x=s(y), y\Incl p, \GSD & \rabove{(=_{Lar})} \\
\cline{1-1}
t(s(p))\Incl t(s(p)), x=s(y), y\Incl p, \GSD & \rabove{(\Incl_{ar})} \end{array}
\right . \convd
%Weakening $D$ we may obtain:
 \begin{array}{cl}
D_1 \left \{ \begin{array}{rl}
x\Incl s(p), t(x)\Incl t(s(p)), x=s(y), y\Incl p, \GSD \\ \cline{1-1}
x\Incl s(p), t(s(p))\Incl t(s(p)), x=s(y), y\Incl p, \GSD & \rabove{(\Incl_{ar})} \end{array}
\right . \\ \cline{1-1}
s(y)\Incl s(p), t(s(p))\Incl t(s(p)), x=s(y), y\Incl p, \GSD &
\rabove{(=_{Lar})} \\ \cline{1-1}
s(p)\Incl s(p), t(s(p))\Incl t(s(p)), x=s(y), y\Incl p, \GSD &
\rabove{(\Incl_{ar})} \end{array} \]
Occurence of $t(s(p))\Incl t(s(p))$ in $D_1$ can be eliminated by induction
hypothesis $h(D_1)<h(D)$, and of $s(p)\Incl s(p)$ by $\gamma[s(p)] < \gamma[t(s(p))]$.
%
\item All the remaining cases can be easily swapped yielding an earlier
occurrence of $t\Incl t$.

($E_s$) :  Since the active and the side formula of the subsequent
($\Incl_{ar}$) have to share a variable in the LHS, neither might be active in 
this application of ($E_s$).

($\Incl_s$) : Activity of $t(y)\Incl t(s)$ in this rule, can be simulated by
the activity of $y\Incl s$ which also must be present.

($=_{sr}$), ($Sp.cut$), ($cut_x$) are trivial.
\end{LSA}
%
\item  $R$ is ($=_{Lar}$) and $D$ ends as shown below :
\[ D \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ \cline{1-1}
t(y)\Incl t(s), y=s, \Gamma\Seq\Delta & \rabove{R_1} \\ \cline{1-1}
t(s) \Incl t(s), y=s, \GSD & \rabove{(=_{Lar})} \end{array} \right .\]
%
\begin{LSA}
%
\item $R_1$ is ($\Incl_{ar}$) The two possibilities are that $t'(y)\Incl t$ was
\ref{it:yact} active
or \ref{it:ymod} modified in $R_1$. The former requires $t'(y)$ to be the variable
$y$.
\begin{LSB}
\item\label{it:yact} $y\Incl t$ active:
\[ D \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ 
y\Incl t, y=t, q(y)\preceq p, \Gamma\Seq\Delta  \\ \cline{1-1}
y\Incl t, y=t, q(t)\preceq p, \Gamma\Seq\Delta & \rabove{(\Incl_{ar})} \\ \cline{1-1}
t \Incl t, y=t, q(t)\preceq p, \GSD & \rabove{(=_{Lar})} \end{array} \right
. \convd
%Instead, we may use
  \begin{array}{cl} D_1 \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ 
y\Incl t, y=t, q(y)\preceq p, \Gamma\Seq\Delta  \\ \cline{1-1}
t\Incl t, y=t, q(y)\preceq p, \Gamma\Seq\Delta & \rabove{(=_{Lar})} \end{array}
\right . \\ \cline{1-1}
t \Incl t, y=t, q(t)\preceq p, \GSD & \rabove{(=_{Lar})} \end{array} \]
and induction hypothesis, $h(D_1)<h(D)$, gives the conclusion. 
%\begin{REMARK}
%This merely exemplifies  the fact that activity of $y\Incl t$, can be
%simulated by activity of $y=t$: in 
 %\end{REMARK}
%
\item\label{it:ymod} $y\Incl t$ was modified (we write it as $q(y)\Incl q(p(t))$)
\[ D \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ 
y\Incl p(x), q(y)\Incl q(p(t)), x=t, \GSD \\ \cline{1-1}
y\Incl p(x), q(p(x))\Incl q(p(t)), x=t, \GSD & \rabove{(\Incl_{ar})} \\ \cline{1-1}
y\Incl p(x), q(p(t))\Incl q(p(t)), x=t, \GSD & \rabove{(=_{Lar})} \end{array} \right
. \convd
%Then we derive the same sequent
 D' \left \{ \begin{array}{cl} D_1 \left \{ \begin{array}{rl}
\multicolumn{1}{c}{\vdots} \\ 
y\Incl p(t), y\Incl p(x), q(y)\Incl q(p(t)), x=t, \GSD \\ \cline{1-1}
y\Incl p(t), y\Incl p(x), q(p(t))\Incl q(p(t)), x=t, \GSD & \rabove{(\Incl_{ar})} \end{array}
\right . \\ \cline{1-1}
y\Incl p(x), y\Incl p(x), q(p(t))\Incl q(p(t)), x=t, \GSD & \rabove{(=_{Rar})} \end{array} \right
.\]
\end{LSB}
%
\item $R_1$ is ($E_a$)
\[ D \left \{ \begin{array}{rl}
x\Incl p, y\Incl t(x), t(p)=y, \GSD \\ \cline{1-1}
y\Incl t(p), t(p)=y, \GSD  & \rabove{(E_a)} \\ \cline{1-1}
t(p)\Incl t(p), t(p)=y, \GSD  & \rabove{(=_{Lar})} \end{array} \right. \convd
%Construct:
 D' \left \{ \begin{array}{rl}
x\Incl p, y\Incl t(x), t(p)=y, \GSD \\ \cline{1-1}
y\Incl t(p), t(p)=y, \GSD  & \rabove{(E_a)} \\ \cline{1-1}
y\Incl y, t(p)=y, \GSD  & \rabove{(=_{Rar})} \end{array} \right . \]
and $y\Incl y$ can be eliminated by induction hypothesis on $\gamma[t]$.
%
\item $R_1$ is ($=_{Rar}$) Then LHS of the side inclusion must be a variable,
i.e., 
\[ D \left \{ \begin{array}{rl}
y\Incl t(p), p=q, y=t(q), \GSD \\ \cline{1-1}
y\Incl t(q), p=q, y=t(q), \GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
t(q)\Incl t(q), p=q, y=t(q), \GSD & \rabove{(=_{Lar})} \end{array} \right . \convd
%We construct $D'$ as follows:
 D' \left \{ \begin{array}{cl}
  D_1 \left \{ \begin{array}{rl}
 y\Incl t(p), p=q, y=t(q), y=t(p), \GSD \\ \cline{1-1}
t(p)\Incl t(p), p=q, y=t(q), y=t(p), \GSD & \rabove{(=_{Lar})} 
\end{array} \right . \\ \cline{1-1}
t(p)\Incl t(p), p=q, y=t(q), y=t(q), \GSD & \rabove{(=_{a=})} 
\end{array} \right . \]
 $h(D_1)<h(D)$ yields the conclusion.
%
\item $R_1$ is ($=_{Lar}$) 
\[ D \left \{ \begin{array}{rl}
 t(x)\Incl t(s(p)), y=p, x=s(y), \GSD \\ \cline{1-1}
 t(s(y))\Incl t(s(p)), y=p, x=s(y), \GSD & \rabove{(=_{Lar})} \\ \cline{1-1}
 t(s(p))\Incl t(s(p)), y=p, x=s(y), \GSD & \rabove{(=_{Lar})} \end{array}
 \right . \convd
%Weakening we get:
 \begin{array}{cl} D_1 \left \{ \begin{array}{rl}
 x=s(p), t(x)\Incl t(s(p)), y=p, x=s(y), \GSD \\ \cline{1-1} 
 x=s(p), t(s(p))\Incl t(s(p)), y=p, x=s(y), \GSD & \rabove{(=_{Lar})} 
\end{array} \right .  \\ \cline{1-1}
 x=s(y), t(s(p))\Incl t(s(p)), y=p, x=s(y), \GSD & \rabove{(=_{a=})} 
\end{array} \]
 $h(D_1)<h(D)$ gives the conclusion. \\
In the last two cases we have used lemma~\ref{le:asinNEQ3} which admits ($=_{a=}$).

%
\item All other cases of $R_1$ can be easily swapped leading to an earlier
occurrence of $t\Incl t$ (cf. the end of case 1. for $R$ = ($\Incl_{ar}$))
%
\end{LSA}
%
\item  $R$ is ($E_a$) This would require a degenerate application of this
rule which is excluded by lemma \ref{le:noEad}. 
%
\item  $R$ is ($=_{Rar}$) Since this requires a variable in the LHS, we are
back in the ground case for $\gamma[t]=0$.
\end{LS}
\end{PROOF}
%
\noindent
As an immediate corollary of this lemma, we have a strengthening of 
lemma~\ref{le:neq3cisneq4c}: 
\begin{COROLLARY}\label{co:neq3isneq4}
$NEQ_3\equiv NEQ_4$.
\end{COROLLARY}
Thus, rules admissible in $NEQ_3$ are admissible in $NEQ_4$ too.
%
\begin{LEMMA}\label{le:noErsd} $\der{NEQ_4}DS\ \impl\ \der{NEQ_4}{D^*}S$
and $D^*$ contains no applications of ($E_{Rsd}$).
\end{LEMMA}
\begin{PROOF}
By induction on the number of applications of ($E_{Rsd}$) in a given
derivation $D$. By lemma~\ref{le:noEad} %, resp. \ref{le:noEsd} 
we assume that $D$ contains no applications of $(E_{ad})$.
%, resp. $(E_{sd})$ 
\[ \begin{array}{cl}
D_1\left\{ \begin{array}{cl}
 \vdots & \\ \cline{1-1}
 x\Incl t,\GSD,p\preceq x & \raisebox{1.2ex}[1.5ex][0ex]{$R$}\end{array} \right. \\ \cline{1-1}
 \GSD,p\preceq t  &  \raisebox{1.2ex}[1.5ex][0ex]{($E_{Rsd}$)}
\end{array} \]
\begin{LS}
\item $R$ is $(=_{Rar})$
\[ \begin{array}{cl}
s=r, x\Incl t(r),\GSD, p\preceq x  & \\ \cline{1-1}
s=r, x\Incl t(s),\GSD,p\preceq x & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Rar}$)} \\ \cline{1-1}
s=r,\GSD,p\preceq t(s)  &  \raisebox{1.2ex}[1.5ex][0ex]{($E_{Rsd}$)}
\end{array} 
\conv 
\begin{array}{cl}
 s=r,x\Incl t(r),\GSD, p\preceq x  & \\ \cline{1-1}
 s=r, \GSD,p\preceq t(r) & \raisebox{1.2ex}[1.5ex][0ex]{($E_{Rsd}$)} \\ \cline{1-1}
 s=r, \GSD,p\preceq t(s) & \raisebox{1.2ex}[1.5ex][0ex]{($=_{Rs}$)} 
\end{array}
\]
($E_{Rsd}$) can be eliminated by induction on $h(D)$. 
The application of ($=_{Rs}$), admissible in $NEQ_3$ (lemma~\ref{le:noeqSD}) and, 
by corollary~\ref{le:neq3cisneq4c} in $NEQ_4$, does not then introduce any new
applications of $E_s$ by the qualification in lemma~\ref{le:noeqSD}.
\item $R$ is $(\Incl_{ar})$
\[ \begin{array}{cl}
x\Incl t, w(x)\Incl q,\GSD, p\preceq x  & \\ \cline{1-1}
x\Incl t, w(t)\Incl q,\GSD,p\preceq x & \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)} \\ \cline{1-1}
w(t)\Incl q, \GSD,p\preceq t  &  \raisebox{1.2ex}[1.5ex][0ex]{($E_{Rsd}$)}
\end{array} 
\conv 
\begin{array}{cl}
x\Incl t, w(x)\Incl q,\GSD, p\preceq x  & \\ \cline{1-1}
x\Incl t, w(x)\Incl q,\GSD,p\preceq t & \raisebox{1.2ex}[1.5ex][0ex]{$(E_{Rsd})+W$} \\ \cline{1-1}
w(t)\Incl q, \GSD,p\preceq t  &  \raisebox{1.2ex}[1.5ex][0ex]{($\Incl_{ar}$)}
\end{array}
\]
\item $R$ is $(E_a)$ 
\[ \begin{array}{cl}
x\Incl t(z), z\Incl q,\GSD, p\preceq x  & \\ \cline{1-1}
x\Incl t(q), \GSD,p\preceq x & \raisebox{1.2ex}[1.5ex][0ex]{($E_{a}$)} \\ \cline{1-1}
 \GSD,p\preceq t(q)  &  \raisebox{1.2ex}[1.5ex][0ex]{($E_{Rsd}$)}
\end{array} 
\conv 
\begin{array}{cl}
x\Incl t(z), z\Incl q,\GSD, p\preceq x  & \\ \cline{1-1}
z\Incl t(q), \GSD,p\preceq t(z) & \raisebox{1.2ex}[1.5ex][0ex]{($E_{Rsd}$)} \\ \cline{1-1}
 \GSD,p\preceq t(q) & \raisebox{1.2ex}[1.5ex][0ex]{($E_{s}$)} 
\end{array}
\]
By lemma~\ref{le:noEad} the application of $(E_a)$ is not $(E_{ad})$, i.e. $t(z)\not=z$.
Hence, the resulting application of $(E_s)$ is not $(E_{Rsd})$.
\end{LS}
The rest is simple. $(=_{Lar})$ cannot result in $x\Incl t$, so it can be swapped.
Similarly, $(\preceq_{sr})$ modify at most LHS in the consequent, and $(E_s)$ involves 
another eigen-variable, so they can be swapped.
as well.
\end{PROOF}

In the proof of the following ($cut$)-elimination lemma, 
we may thus introduce additional
\\[1ex]
\noindent
{\bf Assumptions:} Derivations in $NEQ_4$ contain no:

\begin{tabular}{ll}
1. applications of ($E_{ad}$) & by lemma \ref{le:noEad} \\
2. applications of ($E_{sd}$) or ($E_{Rsd}$) & by lemma \ref{le:noEsd}, \ref{le:noErsd} \\
3. formula $x=x$ in the antecedent & by lemma \ref{le:noxx} \\
4. formula $t\Incl t$ in the antecedent & by lemma \ref{le:nott} \\
5. $NEQ_4$ admits the same rules as $NEQ_3$ & by corollary \ref{co:neq3isneq4}
\end{tabular} 

\input{proof}
%
\noindent
The lemma yields the problematic implication of the 
\begin{THEOREM}\label{th:neq4cisneq4}
 $NEQ_4^c \equiv NEQ_4$ \end{THEOREM}
Combined with lemma~\ref{le:neq3cisneq4c} and corollary \ref{co:neq3isneq4} 
we have also:
\begin{COROLLARY}
$NEQ_3^c \equiv NEQ_4^c \equiv NEQ_4 \equiv NEQ_3$.
\end{COROLLARY}

\section{$NEQ_5$}\label{se:lastNEQ}
Although the elementary cut rule \reff{ru:cutx} from definition \ref{de:neq4}
is relatively innocent (especially, taking into account the remark
\ref{re:cutx}), we make the final step showing that it can be replaced by a
slightly strenghtened version of ($E_a$).
\begin{DEFINITION}\label{de:neq5}
 $NEQ_5$ is obtained from $NEQ_4$ by removing ($E_{sd}$), ($E_{rsd}$) and the elementary
 ($cut_x$), and exchanging the rule ($E_a$) by the following rule:
\PROOFRULE{x\Incl t, y\preceq r(x),\GSD}{y\preceq r(t),\GSD} ($E_a^*$)\ \ \ \ $t,r(x)\not\in\Vars$
\end{DEFINITION}
The rules of $NEQ_5$, which is our final calculus, are given in figure \ref{fi:neq5}.

\begin{figure}[hbt]
\hspace*{6em}\begin{tabular}{||l@{\ \ \ \ \ \ \ \ \ \ \ \ }ll||}
\hline\hline
\multicolumn{2}{||c}{{\bf Axioms}:} & \\[1ex]
\multicolumn{3}{||c||}{$\Gamma\Seq\Delta,p\Incl p$;\ \ \ \ \ \ $\Gamma\Seq\Delta, x=x$;\ \ \
\ \ \ 
$\Gamma,s=t\Seq\Delta, s=t$ : $s,t\not\in\Vars$}\\[2ex]
%
\multicolumn{2}{||c}{{\bf Identity rules}:} & \\[1ex]
%
\prule{t=s,\Gamma\Seq\Delta, p(s)\preceq q}{t=s,\Gamma\Seq\Delta, p(t)\preceq q} ($=_{sr}$) & 
\prule{s=t, x\Incl p(s), \Gamma\Seq\Delta}{s=t, x\Incl p(t),\Gamma\Seq\Delta} ($=_{Rar}$) 
    & \\[2.5ex]
  {\footnotesize \ \ \ - $t\not\in\Vars$} & \prule{x=t, w(x)\Incl q,
\Gamma\Seq\Delta}{x=t, w(t)\Incl q,\Gamma\Seq\Delta} ($=_{Lar}$) & \\[2ex]
&  \multicolumn{2}{l||}{{\footnotesize \ \ \
 - $w(t)\not\in \Vars$}} \\[2ex]
%&  {\footnotesize \ \ \ - $x\in\Vars$} & \\[2ex]
%
\multicolumn{2}{||c}{{\bf Inclusion rules}:}
& \\[1ex]
\prule{t\Incl s, \Gamma\Seq \Delta, p(s)\preceq q}{t\Incl s, \Gamma\Seq
\Delta, p(t)\preceq q} 
($\Incl_s$) & 
\prule{x\Incl t, w(x)\preceq q, \Gamma\Seq\Delta}{x\Incl t, w(t)\preceq q, \Gamma\Seq\Delta}
 ($\Incl_{ar}$) & \\[2ex]
  {\footnotesize \ \ \ - $t\not\in\Vars$} 
&  \multicolumn{2}{l||}{{\footnotesize \ \ \
 - $w(t)\not\in \Vars$}} \\[2ex]
%
\multicolumn{2}{||c}{{\bf Elimination rules}:} & \\[1ex]
\prule{\Gamma, x\Incl t\Seq\Delta,phi} 
  {\Gamma\Seq\Delta,\phi_t^x}  ($E_s$) & 
\multicolumn{2}{l||}{\prule{x\Incl t, y\preceq r(x), \Gamma\Seq\Delta}
  {y\preceq r(t),\Gamma\Seq\Delta}  ($E_a^*$)} \\[.5ex]
 {\footnotesize \ \ \ - $x\not\in \Vars(\Gamma,\Delta,t)$} &  \multicolumn{2}{l||}{{\footnotesize \ \ \
 - $x\not\in \Vars(t,\Gamma,\Delta,y)$}} \\
 {\footnotesize \ \ \ - at most one $x$ in $\phi$;} &  \multicolumn{2}{l||}{{\footnotesize \ \
 \ - at most one occurrence of $x$ in $r$ }} \\
 {\footnotesize \ \ \ - $t\not\in\Vars$ and $\phi\not= p\Incl x$;} &  \multicolumn{2}{l||}{{\footnotesize \ \
 \ - $t, r(x) \not\in\Vars$; }} \\[2ex]
%
\multicolumn{3}{||c||}{{\bf Specific cut rules}:}\\
\multicolumn{3}{||c||}
{for each specific axiom $\Ax_k$: \(a_1,...,a_n\Seq s_1,...,s_m\), 
a  rule:}\\[1ex]
\multicolumn{3}{||c||}
{\prule{\Gamma\Seq\Delta,a_1\ ;...;\ \Gamma\Seq\Delta,a_n\ ;\ 
s_1,\Gamma\Seq\Delta\ ;...;\ s_m,\Gamma\Seq\Delta} 
{\Gamma\Seq\Delta}\ \ \ ($Sp.cut_k$)} \\
 \hline\hline
\end{tabular} 
\caption{The final calculus $NEQ_5$ ($x,y\in\Vars$)}\label{fi:neq5}
\end{figure}

The following two lemmas establish the equivalence of
  $NEQ_4$ and $NEQ_5$.

\begin{LEMMA}\label{le:Ea*}
The rule ($E_a^*$) is admissible in $NEQ_4$.
\end{LEMMA}
\begin{PROOF}
By lemma \ref{le:noEad}, we may assume that the application of ($E_a$) in
$NEQ_4$ is not degenerate (in particular, $t\not\in\Vars$ and hence $r(t)\not\in\Vars$).
Weakening the assumption of the rule by $y=r(x)$, we obtain the required
derivation:
\[ \begin{array}{rl}
 y\Incl r(x), x\Incl t, y=r(x), \GSD \\ \cline{1-1}
 y\Incl r(x), x\Incl t, y=r(t), \GSD & \rabove{(\Incl_a)} \\ \cline{1-1}
 y\Incl r(t), y=r(t), \GSD & \rabove{(E_a)} \\ \cline{1-1}
 y\Incl y, y=r(t), \GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
  y=r(t), \GSD & \rabove{(cut_x)} \end{array} \]
\end{PROOF}

\begin{LEMMA}\label{le:nocutx}
   $NEQ_4 \equiv NEQ_5$
\end{LEMMA}
\begin{PROOF}
   $NEQ_5\ \impl\ NEQ_4$ follows from lemma
   \ref{le:Ea*}. To show the other direction, we have to show admissibility
   of ($cut_x$) in $NEQ_5$. 
(By lemmas \ref{le:noEad}, \ref{le:noEsd}, \ref{le:noErsd}, the applications
of ($E_{ad}$), ($E_{sd}$) and ($E_{rsd}$) are not needed in $NEQ_4$.)
We use induction on $\<\#(cut_x,D),h(D)\>$, where
   $D$ is a derivation in $NEQ_4$ applying a rule $R$ just before ($cut_x$).
\begin{LS}
\item $R$ is ($=_{Lar}$) or ($\Incl_{ar}$): The modified term of these rules cannot be 
a variable, hence they cannot produce $x\Incl x$ and so can be swapped with ($cut_x$).
%
\item $R$ is ($=_{Rar}$):
Consider the rule $R_1$ applied before
\begin{LSA}
\item $R_1$ is ($=_{Ra}$):
{\footnotesize \[ \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\ 
x\Incl t(r), t(p)=x, r=p,\GSD  \\ \cline{1-1}
x\Incl t(p), t(p)=x, r=p, \GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
x\Incl x,  t(p)=x, r=p, \GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
           t(p)=x, r=p,\GSD & \rabove{(cut_x)} \end{array}  \conv 
%Weakening the derivation we obtain
 \begin{array}{rl}
%\multicolumn{1}{c}{\vdots} \\ 
x\Incl t(r), t(p)=x, r=p, t(r)=x,\GSD  \\ \cline{1-1}
x\Incl x, t(p)=x, r=p, t(r)=x,\GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
   t(p)=x, r=p, t(r)=p,\GSD & \rabove{(cut_x)} \\ \cline{1-1}
           t(p)=x, r=p, t(p)=x, \GSD & \rabove{(=_{a=})} \end{array} \] }
\item $R_1$ is ($\Incl_{ar}$):
The predecessor of the cut formula may be modified or active in this application
\begin{LSB}
 \item\label{it:modIncl} It is modifed. This case is impossible since the modified
term of the application of ($\Incl_{ar}$) cannot be a variable.
% (if \Incl_a can introduce a variable)
%  \[ \begin{array}{rl}
%  y\Incl t, x=t, y\Incl x, \GSD \\ \cline{1-1}
%  x\Incl t, x=t, y\Incl x, \GSD & \rabove{(\Incl_a)} \\ \cline{1-1}
%  x\Incl x, x=t, y\Incl x, \GSD & \rabove{(=_{Ra})} \\ \cline{1-1}
%  x=t, y\Incl x, \GSD & \rabove{(cut_x)} \end{array} \conv
%   \begin{array}{rl}
%  y\Incl t, x=t, y\Incl x, y=t, \GSD \\ \cline{1-1}
%  y\Incl y, x=t, y\Incl x, y=t, \GSD & \rabove{(=_{Ra})} \\ \cline{1-1}
%            x=t, y\Incl x, y=t, \GSD & \rabove{(cut_x)} \\ \cline{1-1}
%  x=t, y\Incl x, x=t, \GSD & \rabove{(\Incl_a)} \end{array} \]
 \item It is active:
\[ \begin{array}{rl}
 x\Incl t, x=t, s(x)\preceq q, \GSD \\ \cline{1-1}
 x\Incl t, x=t, s(t)\preceq q, \GSD & \rabove{(\Incl_{ar})} \\ \cline{1-1}
 x\Incl x, x=t, s(t)\preceq q, \GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
           x=t, s(t)\preceq q, \GSD & \rabove{(cut_x)} \end{array} \conv
%As usual, we can simulate activity of $\Incl$ by $=$:
 \begin{array}{rl}
 x\Incl t, x=t, s(x)\preceq q, \GSD \\ \cline{1-1}
 x\Incl x, x=t, s(x)\preceq q, \GSD & \rabove{(=_{Rar})} \\ \cline{1-1}
          x=t, s(x)\preceq q, \GSD & \rabove{(cut_x)} \\ \cline{1-1}
           x=t, s(t)\preceq q, \GSD & \rabove{(=_{Lar})} \end{array} \]
\end{LSB}
\item $R_1$ is ($=_{Lar}$):
This requires the active formula to be an equality of two variables, with the
predecessor of the cut formula as the side formula. The
case is impossible for the same reasons as \ref{it:modIncl}.
%
\item $R_1$ is ($E_a$):
then the side formula of ($=_{Rar}$) was modified by ($E_a$). This is the case
where ($E_a$) would not suffice and where we need ($E_a^*$):
%and \ref{ca:modact} when the active 
%\begin{LSB}
%\item\label{ca:modside}
{\scriptsize  \[ \begin{array}{rl}
x\Incl t,  y \Incl r(x),  y=r(t), \GSD \\ \cline{1-1}
 y \Incl r(t),  y=r(t), \GSD  & \rabove{(E_a)} \\ \cline{1-1}
 y \Incl y,  y=r(t), \GSD  & \rabove{(=_{Rar})} \\ \cline{1-1}
  y=r(t), \GSD  & \rabove{(cut_x)} \end{array} \conv
%Weakening, we can swap -- notice that here we need ($E_a^*$):
  \begin{array}{rl}
x\Incl t,  y \Incl r(x),  y=r(t), y=r(x), \GSD \\ \cline{1-1}
x\Incl t,  y \Incl y,  y=r(t), y=r(x), \GSD  & \rabove{(=_{Rar})} \\ \cline{1-1}
 x \Incl t,  y=r(t), y=r(x), \GSD  & \rabove{(cut_x)} \\ \cline{1-1}
  y=r(t), y=r(t), \GSD  & \rabove{(E_a^*)} \end{array} \] }
%\item\label{ca:modact}
% \[ \begin{array}{rl}
%x\Incl t,  y \Incl r(t),  y=r(x), \GSD \\ \cline{1-1}
%           y \Incl r(t),  y=r(t), \GSD  & \rabove{(E_a)} \\ \cline{1-1}
%              y \Incl y,  y=r(t), \GSD  & \rabove{(=_{Ra})} \\ \cline{1-1}
%                      y=r(t), \GSD  & \rabove{(cut_x)} \end{array} \]
%We procede as in the previous case
% \[ \begin{array}{rl}
%x\Incl t,  y \Incl r(x),  y=r(x), y=r(t), \GSD \\ \cline{1-1}
%x\Incl t,  y \Incl y,  y=r(t), y=r(x), \GSD  & \rabove{(=_{Ra})} \\ \cline{1-1}
% x \Incl t,  y=r(t), y=r(x), \GSD  & \rabove{(cut_x)} \\ \cline{1-1}
%  y=r(t), y=r(t), \GSD  & \rabove{(E_a)} \end{array} \]
%\end{LSB}
\item $R_1$ is ($E_s$), ($\Incl_s$), ($=_s$) or ($Sp.cut$):
These rules can be trivially postponed after ($cut_x$), where the possible
activity of $y\Incl t$ in ($\Incl_s$) can be simulated by $y=t$.
\end{LSA}
%
\item $R$ is ($E_a$): If the predecessor of the cut formula were to be
modified by this rule, its application would be degenerate, which is
excluded by lemma \ref{le:noEad}.
% (cf. \ref{ca:imposEa}).
\item Any application of ($E_s$), ($\Incl_s$), ($=_s$) or ($Sp.cut$) as $R$
can be easily swapped with ($cut_x$), since they do not affect the antecedent of a sequent.
\end{LS}
\end{PROOF}
%

This is the end of the story. Combining the chain of equivalences of the
intermediary calculi given in lemmas \ref{le:neqisneq1}, \ref{le:neq1isneq2},
\ref{le:neq2isneq3}, \ref{le:neq3cisneq4c}, theorem \ref{th:neq4cisneq4} and
the above lemma \ref{le:nocutx}, we conclude that $NEQ_5$ is a cut-free
equivalent of $NEQ$.

In the following section, we study the special case of the calculus
$NEQ_5$ without any specific axioms, showing further possibility of
simplifications. 

\section{No specific axioms -- no elimination rules}\label{se:noax}
We have shown that calculus $NEQ$ with specific axioms can be replaced by an
equivalent calculus with specific cut rules.
In the presence of the specific cut rules, the general ($cut$)
can be eliminated. 
Obviously, derivations of tautologies in the absence of any specific axioms
will not require the specific cut rules. Below we show a much less obvious
and stronger result
-- when no specific axioms are present, 
one can even dispense with the elimination rules! Thus, in spite of the
complications in the world of multialgebras, one can
obtain the multialgebraic tautologies with quite a simple means of the identity
and inclusion rules. Of course, when specific axioms are present, the
elimination rules are indispensable since they play the role of substitution rules.

So, assume the absence of specific axioms, and let $\spNEQ$ be $NEQ_5$
without the ($Sp.cut$) rules.
%
\begin{LEMMA}\label{le:ssp}
Assume that $\der{\spNEQ}D{\GSD}$ and for an $x\in\Vars$
\begin{enumerate}\MyLPar
\item\label{ca:ax} if an equation $s(x)=t \in \Delta$ then there is only this one
occurrence of $x$ in $\Delta$,
\item\label{ca:el2} if $x\preceq q \in\Gamma$ then $x$ is different from the LHS of any
inclusion modified by an application of ($E_a^*$) in $D$,
% this does not seem necessary \item $x\not\in\Vars(t)$,
\end{enumerate}
\noindent
then $\der{\spNEQ}{D^*}{(\GSD)_t^x}$ (with {\em all} $x$'s replaced by $t$)
\end{LEMMA}
\begin{PROOF}
The intention of these conditions is to enable exactly the same derivations
with $t$ occurring instead of $x$.\footnote{To be completely precise: we may
obtain applications of ($\Incl_{anr}$) instead of ($\Incl_a$), but these can be
eliminated by lemma~\ref{le:noar}.}
The case \ref{ca:ax} prevents us from concluding derivability of $\GSD, t=t$
from the fact that $\GSD,x=x$, being an axiom, is derivable. 
In all other cases, we can
 start derivation with an axiom where $t$ occurs instead of $x$. All the
 rules applied in $D$ can be applied (or simulated, by admissibility of the
 corresponding rules with terms instead of variables) in the same order in
 $D^*$.
The only potential exception is ($E_a^*$):
\[ D \left \{ \begin{array}{rl}
 \multicolumn{1}{c}{\vdots} \\
 y\Incl q, x\preceq r(y),\GSD  \\ \cline{1-1}
 x\preceq r(q),\GSD & \rabove{(E_a^*)} \end{array} \right . \]
The resulting sequent cannot be obtained with $t$ substituted for $x$ by the
application of ($E_a^*$) unless $t$ is a variable. This case, however, is
excluded by condition \ref{ca:el2}.
\end{PROOF}

\begin{DEFINITION}\label{de:neq6}
 $\elNEQ$ is obtained from $\spNEQ$ by removing the elimination rules ($E_s$)
 and ($E_a^*$).
\end{DEFINITION}
\noindent
Since $\elNEQ$ is our final calculus for the case without specific axioms, we
summarize its rules in figure \ref{fi:neq6}. 

\begin{figure}[hbt]
\hspace*{6em}\begin{tabular}{||l@{\ \ \ \ \ \ \ \ \ \ \ \ }ll||}
\hline\hline
\multicolumn{2}{||c}{{\bf Axioms}:} & \\[1ex]
\multicolumn{3}{||c||}{$\Gamma\Seq\Delta,p\Incl p$;\ \ \ \ \ \ $\Gamma\Seq\Delta, x=x$;\ \ \
\ \ \ 
$\Gamma,s=t\Seq\Delta, s=t$ : $s,t\not\in\Vars$}\\[2ex]
%
\multicolumn{2}{||c}{{\bf Identity rules}:} & \\[1ex]
%
%
\prule{t=s,\Gamma\Seq\Delta, p(s)\preceq q}{t=s,\Gamma\Seq\Delta, p(t)\preceq q} ($=_{sr}$) & 
\prule{s=t, x\Incl p(s), \Gamma\Seq\Delta}{s=t, x\Incl p(t),\Gamma\Seq\Delta} ($=_{Rar}$) 
    & \\[2.5ex]
  {\footnotesize \ \ \ - $t\not\in\Vars$} & \prule{x=t, w(x)\Incl q,
\Gamma\Seq\Delta}{x=t, w(t)\Incl q,\Gamma\Seq\Delta} ($=_{Lar}$) & \\[2ex]
&  \multicolumn{2}{l||}{{\footnotesize \ \ \
 - $w(t)\not\in \Vars$}} \\[2ex]
%&  {\footnotesize \ \ \ - $x\in\Vars$} & \\[2ex]
%
\multicolumn{2}{||c}{{\bf Inclusion rules}:}
& \\[1ex]
\prule{t\Incl s, \Gamma\Seq \Delta, p(s)\preceq q}{t\Incl s, \Gamma\Seq
\Delta, p(t)\preceq q} 
($\Incl_s$) & 
\prule{x\Incl t, w(x)\preceq q, \Gamma\Seq\Delta}{x\Incl t, w(t)\preceq q, \Gamma\Seq\Delta}
 ($\Incl_{ar}$) & \\[2ex]
  {\footnotesize \ \ \ - $t\not\in\Vars$} 
&  \multicolumn{2}{l||}{{\footnotesize \ \ \
 - $w(t)\not\in \Vars$}} \\[2ex]
 \hline\hline
\end{tabular} 
\caption{The rules of $\elNEQ$ ($x,y\in\Vars$)}\label{fi:neq6}
\end{figure}
%
\begin{REMARK}\label{re:oldhold}
Revisiting the proofs of lemmas \ref{le:nott}  % \ref{le:noxx}, \ref{le:elcut}
and \ref{le:nocutx}, we observe that the transformations used there did not
introduce any new applications of the elimination rules 
% (in \ref{le:nott} and \ref{le:nocutx} 
(we used lemma \ref{le:noeqeq}
% and in \ref{le:noxx} lemma \ref{le:inclaad}, 
but it did not introduce such applications either).
Hence: %, these lemmas hold also for $\elNEQ$, in particular:
\begin{enumerate}
% \item $\der{\elNEQ}{}{x=x, \GSD}\ \impl\ \der{\elNEQ}{}{\GSD}$;
\item ($cut_x$) is admissible in $\elNEQ$ (lemma \ref{le:nocutx});
\item $\der{\elNEQ}{}{t\Incl t, \GSD}\ \impl\ \der{\elNEQ}{}{\GSD}$ (lemma \ref{le:nott});
%\item ($cut$) is admissible in $\elNEQ$;
\item lemma \ref{le:ssp} holds for $\elNEQ$.
\end{enumerate}
\end{REMARK}
\noindent
Using this observation, we get:
%
\begin{LEMMA}\label{le:spneqiselneq}
 $\spNEQ \equiv \elNEQ$
\end{LEMMA}
\begin{PROOF}
 $\Leftarrow$ is obvious, and for $\impl$ we have to show admissibility of
 the elimination rules in $\elNEQ$. Consider the uppermost application of an
 elimination rule $E$:
\begin{LS}
\item $E$ is ($E_a^*$):
 \[ \begin{array}{rl}
D_1 \left \{ \begin{array}{c}
\vdots \\
 x\Incl t, y\preceq r(x),\GSD \end{array} \right . \\ \cline{1-1}
 y\preceq r(t), \GSD & \rabove{(E_a^*)} \end{array} \]
The application implies $x\not\in\Vars(t,y,\Gamma,\Delta)$, and hence the
conditions of lemma \ref{le:ssp} are satisfied. Applying it to $D_1$, we
obtain:
\[ D_1' \left \{ \begin{array}{c}
 \vdots \\
 t\Incl t, y\preceq r(t),\GSD \end{array} \right . \]
and by remark \ref{re:oldhold}, we know that $\der{\elNEQ}{}{y\preceq
r(t),\GSD}$.
\item $E$ is ($E_s$):
 \[ \begin{array}{rl}
      D_1 \left \{ \begin{array}{c}
         \vdots \\
        x\Incl t,\GSD, \phi \end{array} \right . \\ \cline{1-1}
     \GSD, \phi_t^x & \rabove{(E_s)} \end{array} \]
There is at most one occurrence of $x$ in $\Delta,\phi$ so, again, the
conditions of lemma \ref{le:ssp} hold and we can apply it to $D_1$ obtaining
 $t\Incl t,\GSD, \phi_t^x$, which leads to the desired conclusion 
 $\der{\elNEQ}{}{\GSD,\phi_t^x}$.
\end{LS}
\end{PROOF}
\noindent
Thus all multialgebraic tautologies are derivable with the
rather simple calculus $\elNEQ$.

\section{Other connectives}\label{se:connectives}
Since satisfaction of a sequent is defined in the usual way, 
sound\-ness/com\-ple\-te\-ness of $NEQ$ and its equivalence with $NEQ_5$ imply that the entailment
relation in $NEQ_5$ coincides with the semantic consequence. If we restrict
our formulae $\phi$ to the atomic ones (i.e., $s\Incl t$ or $s=t$), this
means that, given a specification with specific axioms $\Ax = \{\phi_1,...,\phi_n\}$, 
 $\MMod(\Ax)\models \phi \Leftrightarrow \der{NEQ_5}{}{\Ax\Seq\phi}$. Since the specific
 axioms are thus incorporated into the actual sequents to be proved, we need
 no ($Sp.cut$) rules and can
 conclude that  \[ \MMod(\Ax)\models \phi \iff \der{\elNEQ}{}{\Ax\Seq\phi}\]
\noindent
Notice that this formulation, however simple and convincing, requires us to
``guess'' the variable names which have to be used in $\phi$ in order to
``match'' the appropriate variable names in the axioms.

Furthermore, we may extend the language introducing other logical operators
in the usual way.
We obtain a sound and complete system $NEQ_i^+$ (for $i\leq 6$) by extending
 $NEQ_i$ with the standard rules \\[1ex]
%
\begin{tabular}{rlrl}
($\neg\ \Seq$) & \PROOFR{\Gamma\Seq\Delta,\phi}{\Gamma,\neg\phi\Seq\Delta} & 
($\Seq\ \neg$) & \PROOFR{\Gamma,\phi\Seq\Delta}{\Gamma\Seq\Delta,\neg\phi} \\
($\lor\ \Seq$) & \PROOFR{\Gamma,\phi_1\Seq\Delta\ \ ;\ \
\Gamma,\phi_2\Seq\Delta}{\Gamma,\phi_1\lor\phi_2\Seq\Delta}
& ($\Seq\ \lor$) &
\PROOFR{\Gamma\Seq\Delta,\phi_1,\phi_2}{\Gamma\Seq\Delta,\phi_1\lor\phi_2} \\
($\land\ \Seq$) &
\PROOFR{\Gamma,\phi_1,\phi_2\Seq\Delta}{\Gamma,\phi_1\land\phi_2\Seq\Delta} &
($\Seq\ \land$) & \PROOFR{\Gamma\Seq\Delta,\phi_1\ \ ;\ \
\Gamma\Seq\Delta,\phi_2}{\Gamma\Seq\Delta,\phi_1\land\phi_2} \\
($\impl\ \Seq$) & \PROOFR{\Gamma,\phi_1\Seq\Delta\ \ ;\ \
\Gamma\Seq\Delta,\phi_2}{\Gamma,\phi_2\impl\phi_1\Seq\Delta}  & ($\Seq\impl$) &
\PROOFR{\Gamma,\phi_1\Seq\Delta,\phi_2}{\Gamma\Seq\Delta,\phi_1\impl\phi_2} 
\end{tabular} \\[1ex]
%
We then have that, for a specification $\Ax=\{\Phi_1,...,\Phi_n\}$ and a
formula $\Phi$, where $\Phi_i$ are built from the atomic equalities and
inclusions with the logical operators,  $\MMod(\Ax)\models \Phi \Leftrightarrow
 \der{NEQ_5^+}{}{\Ax\Seq\Phi}$. A proof in $NEQ_5^+$ will typically consist of a series
 of applications of the above eight rules leading to a sequent
 $\Gamma\Seq\Delta$, to which one then applies the rules of $NEQ_5$.
Here again axioms are incorporated into the formulae, so we can use $\elNEQ$
instead:
 \[ \MMod(\Ax)\models \Phi \iff  \der{\elNEQ^+}{}{\Ax\Seq\Phi} \]

%\section{Further specialization of $Sp.cut$}
%\PROOFRULE{\Gamma_i\Seq\Delta_i,r_i\odot_i s_i\ \ ;\ \ 
%u_j\odot_j v_j,\Gamma_j\Seq\Delta_j} {\bigc_i\Gamma_i,\bigc_j\Gamma_j
%\Seq \bigc_i\Delta_i,\bigc_j\Delta_j}
%

\section{Related work.}\label{se:related}
The resulting system $NEQ_5$, improving the calculi from \cite{WM} and
\cite{Top}, is essentially an extension of the system from
\cite{BK95}. There is only a slight difference in the language which, in our case,
does not include the special ``let'' construction. This construction is
expressible in our language, except for the cases when it occurs in the RHS
of inclusion. On the other hand, our system
deals not only with inclusion, but also with the determinisitc equality.
The restrictions on the inclusion rules are the same.
Also the elimination rules are literally the same in both systems. 
However, we have
made it explicit that they are needed only in the presence of specific axioms
and can be eliminated when no such axioms are involved. 

Sufficiency of $\elNEQ$ is a significant
strengthening of earlier results -- in \cite{BK95} the elimination rules were included
even though no specific axioms were allowed. In fact, since in \cite{BK95}
only inclusions are allowed as atomic formulae, our results show that the
only rules needed for their case are the axioms and the two inclusion rules
from figure \ref{fi:neq6}.

The cut-freeness of the system from \cite{BK95} corresponds to the situations when
no specific axioms are present (i.e., cut-freeness of $NEQ_5$ and $\elNEQ$). 
We have shown how such axioms can be treated explicitly by
the more specific cut rules instead of general cut. Finally, other rules of the calculus have
been given very specific restrictions. All these results enhance significantly proof search.

\subsection*{Acknowledgment}
We thank Valentinas Kriau\v ciukas and Sigurd
Meldal for the comments and help they provided during our work on this paper.

The first three authors were supported by a grant from the Norwegian Research Council.

\begin{thebibliography}{MM99}\MyLPar
\bibitem[BK95]{BK95} M.~Bia{\l}asik, B.~Konikowska. 
   {\em Reasoning with Nondeterministic Specifications,} Tech.~Rep. no.~793, IPI PAN, Warszawa,
   (1995).
\bibitem[Kan63]{K} S.~Kanger,
   {\em A simplified proof method for elementary logic,}
   in Comput. Progr. and Formal Systems, North-Holland, Amsterdam, (1963).
\bibitem[Pli71]{Aida1} A.~Pliu\v skevi\v cien\.e, 
   {\em Elimination of cut-type rules in axiomatic theories with equality,}
   Seminars in mathematics V.A.Steklov Mathem. Inst., Leningrad, 16, 90-94, (1971).
\bibitem[Pli73]{Aida2} A.~Pliu\v skevi\v cien\.e,
   {\em Specialization of the use of axioms for deduction search in 
   axiomatic theories with equality,}
   J. Soviet Math., 1, (1973).
\bibitem[PWM94]{LFCS} A.~Pliu\v skevi\v cien\.e, R.~Pliu\v skevi\v cius,
   M.~Walicki, S.~Meldal,
   {\em On specialization of derivations in axiomatic equality theories,}
   in Proc. of LFCS'94, LNCS vol. 813, (1994).
\bibitem[Wal93]{Mich} M.~Walicki,
   {\em Algebraic Specifications of Nondeterminism,}
   Ph.D. thesis, Institute of Informatics, University of Bergen, (1993).
\bibitem[WB95a]{Broy} M.~Walicki, M.~Broy, Structured Specifications and Implementation of
   Nondeterministic Data Types, {\em Noric Journal of Computing}, vol.~2, (1995).
\bibitem[WM95b]{WM} M.~Walicki, S.~Meldal, 
   Multialgebras, Power Algebras and Complete Calculi of Identities and 
       Inclusions, {\em Recent Trends in Data Type  Specification}, LNCS, vol. 906 (1995).
\bibitem[WM95c]{Top} M.~Walicki, S.~Meldal, 
   A Complete Calculus for the Multialgebraic and Functional Semantics of Nondeterminism,  
       {\em ACM ToPLaS}, vol.~17, no.~2, (1995).
\end{thebibliography} 

\end{document}
